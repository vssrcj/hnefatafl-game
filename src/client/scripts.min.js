var board=function(){function e(){var e=$(this),a=e.attr("class");"attacker"==a?g?(g.attr("class","attacker"),g=null):(e.attr("class","attacker-select"),g=e):g&&("empty"==a?(google_apis.player_move(g.attr("id"),e.attr("id")),g=null):(g.attr("class","attacker"),g=null))}function a(){l.on("click",".row > div > div",e),google_apis.new_game(),c.hide()}function n(e){return 2==e||3==e?(2==e?(c.append("Player won!"),c.addClass("attacker-header")):(c.addClass("defender-header"),c.append("AI won!")),l.off(),c.removeClass("hidden"),!0):!1}function o(){l=$("#board");for(var a="",n=0;d>n;n++){for(var t="<div class='row'>",o=0;u>o;o++)t+="<div><div data-val='0' class='empty' id='"+n+","+o+"'></div></div>";t+="</div>",a+=t}l.append(a),l.on("click",".row > div > div",e)}function i(e,a,n,o){var i=document.getElementById(a),r=$(i);r.attr("class",p[0]);var l=document.getElementById(n),c=$(l);if(c.attr("class",p[e]),o&&o[0])for(var s=0;s<o.length;s++){f=o[s][0],t=o[s][1],console.log(f);var d=document.getElementById(f+","+t),u=$(d);u.attr("class",p[0])}}function r(e){e=e;for(var a=0;a<e.length;a++)for(var n=e[a].length,t=0;n>t;t++){var o=e[a][t],i=document.getElementById(a+","+t),r=$(i);r.attr("class",p[o])}}var l=$("#board"),c=$("#board_header"),s=$("#new_game");const d=9,u=9;var g=null;const p=["empty","attacker","defender","king"];return s.on("click",a),{empty_board:o,new_board:r,move:i,game_end:n}}(),google_apis=function(){function e(){gapi.client.hnefatafl.new_game().execute(function(e){o=e.key,board.new_board(JSON.parse(e.board)),t()})}function a(){gapi.client.hnefatafl.last_player_game().execute(function(a){if(console.log(a),404==a.code)e();else{o=a.key,board.new_board(JSON.parse(a.board));var n=parseInt(a.state);board.game_end(n)||1==n&&t()}})}function n(e,a){var n=e.split(","),i=a.split(",");gapi.client.hnefatafl.player_move({game_key:o,origin_row:n[0],origin_column:n[1],destination_row:i[0],destination_column:i[1]}).execute(function(e){console.log(e),board.move(e.origin_value,e.origin,e.destination,"[]"!=e.captures?JSON.parse(e.captures.replace("(","[").replace(")","]")):null),board.game_end(parseInt(e.game_state))||t()})}function t(){gapi.client.hnefatafl.ai_move({game_key:o}).execute(function(e){console.log(e),board.move(e.origin_value,e.origin,e.destination,"[]"!=e.captures?JSON.parse(e.captures.replace("(","[").replace(")","]")):null),board.game_end(parseInt(e.game_state))})}var o=null;return{new_game:e,player_move:n,ai_move:t,last_player_game:a}}(),google_auth=function(){function e(){gapi.client.load("oauth2","v2"),gapi.client.load("hnefatafl","v1",a,i)}function a(){n(immediate=!0),setTimeout(profile.enableLogin(),2e3)}function n(e){gapi.auth.authorize({client_id:"314272160250-ucrqg44c1oj9knlrfatqvqf1b3pm9819.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/userinfo.email",immediate:e},o)}function t(){return r}function o(e){gapi.client.oauth2.userinfo.get().execute(function(e){e.code||(profile.setLoggedIn(e.picture,e.name),r=!0,google_apis.last_player_game())})}const i="http://localhost:8080/_ah/api";var r=!1;return{loadModules:e,isAuthed:t,signin:n}}(),profile=function(){function e(){t.on("click",a),console.log("enabled"),t.removeClass("hidden")}function a(){console.log("clik"),google_auth.signin(immediate=!1)}function n(e,a){console.log(a),o.html(a),o.removeClass("hidden"),t.addClass("hidden")}var t=$("#login"),o=$("#name");return{enableLogin:e,setLoggedIn:n}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvYXJkLmpzIiwiZ29vZ2xlX2FwaS5qcyIsImdvb2dsZV9hdXRoLmpzIiwicHJvZmlsZS5qcyJdLCJuYW1lcyI6WyJib2FyZCIsIm9uQ2xpY2siLCIkY2VsbCIsIiQiLCJ0aGlzIiwidHlwZSIsImF0dHIiLCIkc2VsZWN0ZWQiLCJnb29nbGVfYXBpcyIsInBsYXllcl9tb3ZlIiwibmV3X2dhbWUiLCIkYm9hcmQiLCJvbiIsIiRib2FyZF9oZWFkZXIiLCJoaWRlIiwiZ2FtZV9lbmQiLCJnYW1lX3N0YXRlIiwiYXBwZW5kIiwiYWRkQ2xhc3MiLCJvZmYiLCJyZW1vdmVDbGFzcyIsImVtcHR5X2JvYXJkIiwidGFibGVfYnVpbGRlciIsInJvdyIsIkhFSUdIVCIsInJvd19idWlsZGVyIiwiY29sIiwiV0lEVEgiLCJtb3ZlIiwib3JpZ2luX3ZhbHVlIiwib3JpZ2luIiwiZGVzdGluYXRpb24iLCJjYXB0dXJlcyIsIm9yIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIiRvciIsInR5cGVOYW1lcyIsImRlIiwiJGRlIiwiaSIsImxlbmd0aCIsImYiLCJ0IiwiY29uc29sZSIsImxvZyIsImNhIiwiJGNhIiwibmV3X2JvYXJkIiwiY29sdW1uV2lkdGgiLCJ2YWwiLCIkbmV3X2dhbWUiLCJnYXBpIiwiY2xpZW50IiwiaG5lZmF0YWZsIiwiZXhlY3V0ZSIsInJlc3BvbnNlIiwiS0VZIiwia2V5IiwiSlNPTiIsInBhcnNlIiwiYWlfbW92ZSIsImxhc3RfcGxheWVyX2dhbWUiLCJjb2RlIiwic3RhdGUiLCJwYXJzZUludCIsIm9yaWdpbnMiLCJzcGxpdCIsImRlc3RpbmF0aW9ucyIsImdhbWVfa2V5Iiwib3JpZ2luX3JvdyIsIm9yaWdpbl9jb2x1bW4iLCJkZXN0aW5hdGlvbl9yb3ciLCJkZXN0aW5hdGlvbl9jb2x1bW4iLCJyZXBsYWNlIiwiZ29vZ2xlX2F1dGgiLCJsb2FkTW9kdWxlcyIsImxvYWQiLCJhZnRlckxvYWRlZCIsInVybCIsInNpZ25pbiIsImltbWVkaWF0ZSIsInNldFRpbWVvdXQiLCJwcm9maWxlIiwiZW5hYmxlTG9naW4iLCJhdXRoIiwiYXV0aG9yaXplIiwiY2xpZW50X2lkIiwic2NvcGUiLCJ1c2VyQXV0aGVkIiwiaXNBdXRoZWQiLCJzaWduZWRpbiIsIm1vZGUiLCJvYXV0aDIiLCJ1c2VyaW5mbyIsImdldCIsInJlc3AiLCJzZXRMb2dnZWRJbiIsInBpY3R1cmUiLCJuYW1lIiwiJGxvZ2luIiwiX2xvZ2luQ2xpY2siLCJzcmMiLCIkbmFtZSIsImh0bWwiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLE9BQUEsV0FvQkEsUUFBQUMsS0FDQSxHQUFBQyxHQUFBQyxFQUFBQyxNQUNBQyxFQUFBSCxFQUFBSSxLQUFBLFFBRUEsYUFBQUQsRUFDQUUsR0FDQUEsRUFBQUQsS0FBQSxRQUFBLFlBQ0FDLEVBQUEsT0FHQUwsRUFBQUksS0FBQSxRQUFBLG1CQUNBQyxFQUFBTCxHQUdBSyxJQUNBLFNBQUFGLEdBQ0FHLFlBQUFDLFlBQ0FGLEVBQUFELEtBQUEsTUFDQUosRUFBQUksS0FBQSxPQUVBQyxFQUFBLE9BR0FBLEVBQUFELEtBQUEsUUFBQSxZQUNBQyxFQUFBLE9BSUEsUUFBQUcsS0FDQUMsRUFBQUMsR0FBQSxRQUFBLG1CQUFBWCxHQUNBTyxZQUFBRSxXQUNBRyxFQUFBQyxPQU9BLFFBQUFDLEdBQUFDLEdBQ0EsTUFBQSxJQUFBQSxHQUFBLEdBQUFBLEdBQ0EsR0FBQUEsR0FDQUgsRUFBQUksT0FBQSxlQUNBSixFQUFBSyxTQUFBLHFCQUdBTCxFQUFBSyxTQUFBLG1CQUNBTCxFQUFBSSxPQUFBLFlBRUFOLEVBQUFRLE1BQ0FOLEVBQUFPLFlBQUEsV0FDQSxJQUVBLEVBR0EsUUFBQUMsS0FFQVYsRUFBQVIsRUFBQSxTQUVBLEtBQUEsR0FEQW1CLEdBQUEsR0FDQUMsRUFBQSxFQUFBQyxFQUFBRCxFQUFBQSxJQUFBLENBRUEsSUFBQSxHQURBRSxHQUFBLG9CQUNBQyxFQUFBLEVBQUFDLEVBQUFELEVBQUFBLElBQ0FELEdBQUEsNENBQUFGLEVBQUEsSUFB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QUFnQixHQUFBSyxFQUFBSCxHQUNBdkQsUUFBQUMsSUFBQXNELEdBR0FJLEVBQUFDLEtBQUFMLEdBQ0FJLEVBQUFuRixZQUFBLFVBQ0FnRixFQUFBbEYsU0FBQSxVQXRCQSxHQUFBa0YsR0FBQWpHLEVBQUEsVUFFQW9HLEVBQUFwRyxFQUFBLFFBeUJBLFFBQ0FpRixZQUFBQSxFQUNBYSxZQUFBQSIsImZpbGUiOiJzY3JpcHRzLm1pbi5qcyIsInNvdXJjZXNDb250ZW50IjpbInZhciBib2FyZCA9IChmdW5jdGlvbigpIHtcblxuICAgdmFyICRib2FyZCA9ICQoXCIjYm9hcmRcIik7XG4gICB2YXIgJGJvYXJkX2hlYWRlciA9ICQoXCIjYm9hcmRfaGVhZGVyXCIpO1xuICAgdmFyICRuZXdfZ2FtZSA9ICQoXCIjbmV3X2dhbWVcIik7XG5cbiAgIGNvbnN0IEhFSUdIVCA9IDk7XG4gICBjb25zdCBXSURUSCA9IDk7XG5cbiAgIHZhciBib2FyZDtcblxuICAgdmFyICRzZWxlY3RlZCA9IG51bGw7XG5cbiAgIGNvbnN0IHR5cGVOYW1lcyA9IFtcbiAgICAgICdlbXB0eScsXG4gICAgICAnYXR0YWNrZXInLFxuICAgICAgJ2RlZmVuZGVyJyxcbiAgICAgICdraW5nJ1xuICAgXTtcblxuICAgZnVuY3Rpb24gb25DbGljaygpIHtcbiAgICAgIHZhciAkY2VsbCA9ICQodGhpcyk7XG4gICAgICB2YXIgdHlwZSA9ICRjZWxsLmF0dHIoJ2NsYXNzJyk7XG5cbiAgICAgIGlmKHR5cGUgPT0gXCJhdHRhY2tlclwiKSB7XG4gICAgICAgICBpZigkc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICRzZWxlY3RlZC5hdHRyKCdjbGFzcycsJ2F0dGFja2VyJyk7XG4gICAgICAgICAgICAkc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkY2VsbC5hdHRyKCdjbGFzcycsJ2F0dGFja2VyLXNlbGVjdCcpO1xuICAgICAgICAgICAgJHNlbGVjdGVkID0gJGNlbGw7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmKCRzZWxlY3RlZCl7XG4gICAgICAgICBpZih0eXBlID09IFwiZW1wdHlcIikge1xuICAgICAgICAgICAgZ29vZ2xlX2FwaXMucGxheWVyX21vdmUoXG4gICAgICAgICAgICAgICAkc2VsZWN0ZWQuYXR0cignaWQnKSxcbiAgICAgICAgICAgICAgICRjZWxsLmF0dHIoJ2lkJylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICAkc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkc2VsZWN0ZWQuYXR0cignY2xhc3MnLCdhdHRhY2tlcicpO1xuICAgICAgICAgICAgJHNlbGVjdGVkID0gbnVsbDtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGZ1bmN0aW9uIG5ld19nYW1lKCkge1xuICAgICAgICAgJGJvYXJkLm9uKCdjbGljaycsJy5yb3cgPiBkaXYgPiBkaXYnLCBvbkNsaWNrKTtcbiAgICAgIGdvb2dsZV9hcGlzLm5ld19nYW1lKCk7XG4gICAgICAkYm9hcmRfaGVhZGVyLmhpZGUoKTtcbiAgIH1cbiAgICRuZXdfZ2FtZS5vbignY2xpY2snLG5ld19nYW1lKTtcbiAgIGZ1bmN0aW9uIGNlbGxDbGljayh0YXJnZXQsIHBhcmFtcykge1xuXG4gICB9XG5cbiAgIGZ1bmN0aW9uIGdhbWVfZW5kKGdhbWVfc3RhdGUpIHtcbiAgICAgIGlmKGdhbWVfc3RhdGUgPT0gMiB8fCBnYW1lX3N0YXRlID09IDMpIHtcbiAgICAgICAgIGlmKGdhbWVfc3RhdGUgPT0gMil7XG4gICAgICAgICAgICAkYm9hcmRfaGVhZGVyLmFwcGVuZChcIlBsYXllciB3b24hXCIpO1xuICAgICAgICAgICAgJGJvYXJkX2hlYWRlci5hZGRDbGFzcyhcImF0dGFja2VyLWhlYWRlclwiKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICRib2FyZF9oZWFkZXIuYWRkQ2xhc3MoXCJkZWZlbmRlci1oZWFkZXJcIik7XG4gICAgICAgICAgICAgJGJvYXJkX2hlYWRlci5hcHBlbmQoXCJBSSB3b24hXCIpO1xuICAgICAgICAgIH1cbiAgICAgICAgICRib2FyZC5vZmYoKTtcbiAgICAgICAgICRib2FyZF9oZWFkZXIucmVtb3ZlQ2xhc3MoJ2hpZGRlbicpO1xuICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICB9XG5cbiAgIGZ1bmN0aW9uIGVtcHR5X2JvYXJkKCkge1xuXG4gICAgICAkYm9hcmQgPSAkKFwiI2JvYXJkXCIpO1xuICAgICAgdmFyIHRhYmxlX2J1aWxkZXIgPSBcIlwiO1xuICAgXHRmb3IodmFyIHJvdz0wOyByb3c8IEhFSUdIVDsgcm93Kyspe1xuICAgICAgICAgdmFyIHJvd19idWlsZGVyID0gXCI8ZGl2IGNsYXNzPSdyb3cnPlwiO1xuICAgXHRcdGZvcih2YXIgY29sPTA7IGNvbDwgV0lEVEg7IGNvbCsrKSB7XG4gICAgICAgICAgICByb3dfYnVpbGRlciArPSBcIjxkaXY+PGRpdiBkYXRhLXZhbD0nMCcgY2xhc3M9J2VtcHR5JyBpZD0nXCIgKyByb3cgKyBcIixcIiArIGNvbCArIFwiJz48L2Rpdj48L2Rpdj5cIjtcbiAgIFx0XHR9XG4gICAgICAgICByb3dfYnVpbGRlciArPSBcIjwvZGl2PlwiO1xuXG4gICAgICAgICB0YWJsZV9idWlsZGVyICs9IHJvd19idWlsZGVyO1xuICAgXHR9XG5cbiAgICAgICRib2FyZC5hcHBlbmQodGFibGVfYnVpbGRlcik7XG5cbiAgICAgICRib2FyZC5vbignY2xpY2snLCcucm93ID4gZGl2ID4gZGl2Jywgb25DbGljayk7XG5cbiAgIH1cblxuICAgZnVuY3Rpb24gZmFkZUluTmV3Q2xhc3Moc291cmNlLCBmcm9tX2NsYXNzLCB0b19jbGFzcykge1xuICAgICAgc291cmNlLnN3aXRjaENsYXNzKGZyb21fY2xhc3MsIHRvX2NsYXNzLCAxMDAwKTtcbiAgIH1cblxuICAgZnVuY3Rpb24gbW92ZShvcmlnaW5fdmFsdWUsIG9yaWdpbiwgZGVzdGluYXRpb24sIGNhcHR1cmVzKSB7XG4gICAgICB2YXIgb3IgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChvcmlnaW4pO1xuICAgICAgdmFyICRvciA9ICQob3IpO1xuICAgICAgJG9yLmF0dHIoJ2NsYXNzJyx0eXBlTmFtZXNbMF0pO1xuXG4gICAgICB2YXIgZGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChkZXN0aW5hdGlvbik7XG4gICAgICB2YXIgJGRlID0gJChkZSk7XG4gICAgICAkZGUuYXR0cignY2xhc3MnLHR5cGVOYW1lc1tvcmlnaW5fdmFsdWVdKTtcblxuICAgICAgaWYoY2FwdHVyZXMgJiYgY2FwdHVyZXNbMF0pIHtcblxuICAgICAgICAgZm9yKHZhciBpPTA7IGk8IGNhcHR1cmVzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBmID0gY2FwdHVyZXNbaV1bMF07XG4gICAgICAgICAgICB0ID0gY2FwdHVyZXNbaV1bMV07XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhmKTtcbiAgICAgICAgICAgIHZhciBjYSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGYgKyBcIixcIiArIHQpO1xuICAgICAgICAgICAgdmFyICRjYSA9ICQoY2EpO1xuICAgICAgICAgICAgJGNhLmF0dHIoJ2NsYXNzJyx0eXBlTmFtZXNbMF0pO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgfVxuXG4gICBmdW5jdGlvbiBuZXdfYm9hcmQoYm9hcmQpIHtcbiAgICAgIGJvYXJkID0gYm9hcmQ7XG4gICBcdGZvcih2YXIgcm93PTA7IHJvdyA8IGJvYXJkLmxlbmd0aDsgcm93Kyspe1xuICAgICAgICAgdmFyIGNvbHVtbldpZHRoID0gYm9hcmRbcm93XS5sZW5ndGg7XG4gICBcdFx0Zm9yKHZhciBjb2w9MDsgY29sIDwgY29sdW1uV2lkdGg7IGNvbCsrKSB7XG4gICAgICAgICAgICB2YXIgdmFsID0gYm9hcmRbcm93XVtjb2xdO1xuXG4gICAgICAgICAgICAgICB2YXIgdCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHJvdyArIFwiLFwiICsgY29sKTtcblxuICAgICAgICAgICAgICAgdmFyICRjZWxsID0gJCh0KTtcblxuICAgICAgICAgICAgICAgJGNlbGwuYXR0cignY2xhc3MnLHR5cGVOYW1lc1t2YWxdKTtcblxuICAgXHRcdH1cbiAgIFx0fVxuXG4gICB9XG5cbiAgIGZ1bmN0aW9uIG1ha2VfbW92ZShmcm9tX3IsIGZyb21fYywgdG9fciwgdG9fYywgY2FwdHVyZXMsIHZhbHVlKSB7XG5cbiAgICAgIGJvYXJkW2Zyb21fcl1bZnJvbV9jXSA9IDA7XG4gICAgICBib2FyZFt0b19yXVt0b19jXSA9IHZhbHVlO1xuICAgICAgJChcIiNcIiArIGZyb21fciArIFwiLFwiICsgZnJvbV9jKS5hdHRyKCdjbGFzcycsJ2VtcHR5Jyk7XG4gICAgICAkKFwiI1wiICsgdG9fciArIFwiLFwiICsgdG9fYykuYXR0cignY2xhc3MnLHR5cGVOYW1lc1t2YWx1ZV0pO1xuICAgICAgZm9yKHZhciBjYXB0dXJlIGluIGNhcHR1cmVzKSB7XG4gICAgICAgICB2YXIgciA9IGNhcHR1cmVbMF07XG4gICAgICAgICB2YXIgYyA9IGNhcHR1cmVbMV07XG4gICAgICAgICBib2FyZFtyXVtjXSA9IDA7XG4gICAgICAgICAkKFwiI1wiICsgciArIFwiLFwiICsgYykuYXR0cignY2xhc3MnLCdlbXB0eScpO1xuICAgICAgfVxuXG4gICB9XG5cbiAgIHJldHVybiB7XG4gICAgICBlbXB0eV9ib2FyZDogZW1wdHlfYm9hcmQsXG4gICAgICBuZXdfYm9hcmQ6IG5ld19ib2FyZCxcbiAgICAgIG1vdmU6IG1vdmUsXG4gICAgICBnYW1lX2VuZDogZ2FtZV9lbmRcbiAgIH07XG59KSgpO1xuIiwidmFyIGdvb2dsZV9hcGlzID0gKGZ1bmN0aW9uKCkge1xuXG4gICB2YXIgS0VZID0gbnVsbDtcblxuICAgZnVuY3Rpb24gbmV3X2dhbWUoKSB7XG4gICAgICBnYXBpLmNsaWVudC5obmVmYXRhZmwubmV3X2dhbWUoKS5leGVjdXRlKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgIEtFWSA9IHJlc3BvbnNlLmtleTtcbiAgICAgICAgIGJvYXJkLm5ld19ib2FyZChKU09OLnBhcnNlKHJlc3BvbnNlLmJvYXJkKSk7XG4gICAgICAgICBhaV9tb3ZlKCk7XG4gICAgICB9KTtcbiAgIH1cblxuICAgZnVuY3Rpb24gbGFzdF9wbGF5ZXJfZ2FtZSgpIHtcblxuICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLmxhc3RfcGxheWVyX2dhbWUoKS5leGVjdXRlKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgIGlmKHJlc3BvbnNlLmNvZGUgPT0gNDA0KSB7XG4gICAgICAgICAgICBuZXdfZ2FtZSgpO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBLRVkgPSByZXNwb25zZS5rZXk7XG4gICAgICAgICAgICBib2FyZC5uZXdfYm9hcmQoSlNPTi5wYXJzZShyZXNwb25zZS5ib2FyZCkpO1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gcGFyc2VJbnQocmVzcG9uc2Uuc3RhdGUpO1xuICAgICAgICAgICAgaWYoIWJvYXJkLmdhbWVfZW5kKHN0YXRlKSlcbiAgICAgICAgICAgICAgIGlmKHN0YXRlID09IDEpIGFpX21vdmUoKTtcbiAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgfVxuXG4gICBmdW5jdGlvbiBwbGF5ZXJfbW92ZShvcmlnaW4sIGRlc3RpbmF0aW9uKSB7XG4gICAgICB2YXIgb3JpZ2lucyA9IG9yaWdpbi5zcGxpdCgnLCcpO1xuICAgICAgdmFyIGRlc3RpbmF0aW9ucyA9IGRlc3RpbmF0aW9uLnNwbGl0KCcsJyk7XG5cbiAgICAgIGdhcGkuY2xpZW50LmhuZWZhdGFmbC5wbGF5ZXJfbW92ZSh7XG4gICAgICAgICBcImdhbWVfa2V5XCI6IEtFWSxcbiAgICAgICAgIFwib3JpZ2luX3Jvd1wiOiBvcmlnaW5zWzBdLFxuICAgICAgICAgXCJvcmlnaW5fY29sdW1uXCI6IG9yaWdpbnNbMV0sXG4gICAgICAgICBcImRlc3RpbmF0aW9uX3Jvd1wiOiBkZXN0aW5hdGlvbnNbMF0sXG4gICAgICAgICBcImRlc3RpbmF0aW9uX2NvbHVtblwiOiBkZXN0aW5hdGlvbnNbMV1cbiAgICAgIH0pLmV4ZWN1dGUoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgYm9hcmQubW92ZShcbiAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbl92YWx1ZSxcbiAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbixcbiAgICAgICAgICAgIHJlc3BvbnNlLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgcmVzcG9uc2UuY2FwdHVyZXMgIT0gXCJbXVwiID9cbiAgICAgICAgICAgIEpTT04ucGFyc2UoXG4gICAgICAgICAgICAgICByZXNwb25zZS5jYXB0dXJlcy5yZXBsYWNlKCcoJywnWycpLnJlcGxhY2UoJyknLCddJylcbiAgICAgICAgICAgICk6IG51bGxcbiAgICAgICAgICk7XG4gICAgICAgICBpZighYm9hcmQuZ2FtZV9lbmQocGFyc2VJbnQocmVzcG9uc2UuZ2FtZV9zdGF0ZSkpKSB7XG4gICAgICAgICAgICBhaV9tb3ZlKCk7XG4gICAgICAgICB9XG4gICAgICB9KTtcbiAgIH1cblxuICAgICAgZnVuY3Rpb24gYWlfbW92ZSgpIHtcbiAgICAgICAgIGdhcGkuY2xpZW50LmhuZWZhdGFmbC5haV9tb3ZlKHtcbiAgICAgICAgICAgIFwiZ2FtZV9rZXlcIjpLRVlcbiAgICAgICAgIH0pLmV4ZWN1dGUoZnVuY3Rpb24ocmVzcG9uc2Upe1xuICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgYm9hcmQubW92ZShcbiAgICAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbl92YWx1ZSxcbiAgICAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbixcbiAgICAgICAgICAgICAgIHJlc3BvbnNlLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgcmVzcG9uc2UuY2FwdHVyZXMgIT0gXCJbXVwiID9cbiAgICAgICAgICAgICAgIEpTT04ucGFyc2UoXG4gICAgICAgICAgICAgICAgICByZXNwb25zZS5jYXB0dXJlcy5yZXBsYWNlKCcoJywnWycpLnJlcGxhY2UoJyknLCddJylcbiAgICAgICAgICAgICAgICk6IG51bGxcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBib2FyZC5nYW1lX2VuZChwYXJzZUludChyZXNwb25zZS5nYW1lX3N0YXRlKSk7XG4gICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgICBuZXdfZ2FtZTogbmV3X2dhbWUsXG4gICAgICAgICBwbGF5ZXJfbW92ZTogcGxheWVyX21vdmUsXG4gICAgICAgICBhaV9tb3ZlOiBhaV9tb3ZlLFxuICAgICAgICAgbGFzdF9wbGF5ZXJfZ2FtZTogbGFzdF9wbGF5ZXJfZ2FtZVxuICAgICAgfTtcbn0pKCk7XG4iLCJ2YXIgZ29vZ2xlX2F1dGggPSAoZnVuY3Rpb24oKXtcblxuICAgY29uc3QgdXJsID0gXCJodHRwOi8vbG9jYWxob3N0OjgwODAvX2FoL2FwaVwiO1xuICAgdmFyIHNpZ25lZGluID0gZmFsc2U7XG5cbiAgIGZ1bmN0aW9uIGxvYWRNb2R1bGVzKCl7XG4gICAgICBnYXBpLmNsaWVudC5sb2FkKFxuICAgICAgICAgJ29hdXRoMicsXG4gICAgICAgICAndjInXG4gICAgICApO1xuICAgICAgZ2FwaS5jbGllbnQubG9hZChcbiAgICAgICAgICdobmVmYXRhZmwnLFxuICAgICAgICAgJ3YxJyxcbiAgICAgICAgIGFmdGVyTG9hZGVkLFxuICAgICAgICAgdXJsXG4gICAgICApO1xuICAgfVxuXG4gICBmdW5jdGlvbiBhZnRlckxvYWRlZCgpIHtcbiAgICAgIHNpZ25pbihpbW1lZGlhdGUgPSB0cnVlKTtcbiAgICAgIHNldFRpbWVvdXQocHJvZmlsZS5lbmFibGVMb2dpbigpLCAyMDAwKTtcblxuICAgfVxuXG4gICBmdW5jdGlvbiBzaWduaW4oaW1tZWRpYXRlKSB7XG4gICAgICBnYXBpLmF1dGguYXV0aG9yaXplKHtcbiAgICAgICAgIGNsaWVudF9pZDogJzMxNDI3MjE2MDI1MC11Y3JxZzQ0YzFvajlrbmxyZmF0cXZxZjFiM3BtOTgxOS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbScsXG4gICAgICAgICBzY29wZTogJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2F1dGgvdXNlcmluZm8uZW1haWwnLFxuICAgICAgICAgaW1tZWRpYXRlOiBpbW1lZGlhdGVcbiAgICAgIH0sIHVzZXJBdXRoZWQpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBpc0F1dGhlZCgpIHtcbiAgICAgIHJldHVybiBzaWduZWRpbjtcbiAgIH1cblxuICAgZnVuY3Rpb24gdXNlckF1dGhlZChtb2RlKSB7XG4gICAgICB2YXIgcmVxdWVzdCA9IGdhcGkuY2xpZW50Lm9hdXRoMi51c2VyaW5mby5nZXQoKS5leGVjdXRlKGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgIGlmICghcmVzcC5jb2RlKSB7XG4gICAgICAgICAgICBwcm9maWxlLnNldExvZ2dlZEluKHJlc3AucGljdHVyZSwgcmVzcC5uYW1lKTtcbiAgICAgICAgICAgIHNpZ25lZGluID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vZ29vZ2xlX2FwaXMubmV3X2dhbWUoZ29vZ2xlX2FwaXMuYWlfbW92ZSk7XG4gICAgICAgICAgICBnb29nbGVfYXBpcy5sYXN0X3BsYXllcl9nYW1lKCk7XG4gICAgICAgICAvLyAgIGdvb2dsZV9hcGlzLmFpX21vdmUoKTtcbiAgICAgICAgICB9XG4gICAgIH0pO1xuICAgfVxuICAgcmV0dXJuIHtcbiAgICAgIGxvYWRNb2R1bGVzOiBsb2FkTW9kdWxlcyxcbiAgICAgIGlzQXV0aGVkOiBpc0F1dGhlZCxcbiAgICAgIHNpZ25pbjogc2lnbmluXG4gICB9O1xuXG59KSgpO1xuIiwidmFyIHByb2ZpbGUgPSAoZnVuY3Rpb24oKSB7XG4gICB2YXIgJGxvZ2luID0gJChcIiNsb2dpblwiKTtcbiAgIC8vdmFyICRwaWN0dXJlID0gJChcIiNwaWN0dXJlXCIpO1xuICAgdmFyICRuYW1lID0gJChcIiNuYW1lXCIpO1xuXG4gICBmdW5jdGlvbiBlbmFibGVMb2dpbigpIHtcbiAgICAgICRsb2dpbi5vbignY2xpY2snLCBfbG9naW5DbGljayk7XG4gICAgICBjb25zb2xlLmxvZygnZW5hYmxlZCcpO1xuICAgICAgJGxvZ2luLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgfVxuICAgZnVuY3Rpb24gX2xvZ2luQ2xpY2soKSB7XG4gICAgICBjb25zb2xlLmxvZygnY2xpaycpO1xuICAgICAgZ29vZ2xlX2F1dGguc2lnbmluKGltbWVkaWF0ZSA9IGZhbHNlKTtcbiAgIH1cbiAgIGZ1bmN0aW9uIF9sb2dvdXRDbGljaygpIHtcbiAgICAgIC8vc2luZ2luKGltbWVkaWF0ZSA9IGZhbHNlKTtcbiAgIH1cbiAgIGZ1bmN0aW9uIHNldExvZ2dlZEluKHNyYywgbmFtZSkge1xuICAgICAgY29uc29sZS5sb2cobmFtZSk7XG4gICAvLyAgIGVuYWJsZUxvZ2luKCk7XG4gICAvLyAgICRwaWN0dXJlLmF0dHIoJ3NyYycsIHNyYyk7XG4gICAgICRuYW1lLmh0bWwobmFtZSk7XG4gICAgICAgICRuYW1lLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgJGxvZ2luLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgLy8gICAkYnRuLmFkZENsYXNzKFwiYWxlcnRcIik7XG4gICAvLy8vICAgJGJ0bi5vZmYoJ2NsaWNrJyk7XG4gICAvLyAgICRidG4ub24oJ2NsaWNrJywgX2xvZ291dENsaWNrKTtcbiAgIH1cbiAgIHJldHVybiB7XG4gICAgICBlbmFibGVMb2dpbjogZW5hYmxlTG9naW4sXG4gICAgICBzZXRMb2dnZWRJbjogc2V0TG9nZ2VkSW5cbiAgIH07XG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
