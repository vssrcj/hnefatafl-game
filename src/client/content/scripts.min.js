var board=function(){function e(){var e=$(this),a=e.attr("class");if("attacker"==a)p?(p.attr("class","attacker"),p=null):(e.attr("class","attacker-select"),p=e);else if(p)if("empty"==a){google_apis.player_move(p.attr("id"),e.attr("id"))}else p.attr("class","attacker"),p=null}function a(){c.on("click",".row > div > div",e),google_apis.new_game(),d.addClass("hidden")}function n(){p&&(p.attr("class","attacker"),p=null)}function o(e){return 2==e||3==e?(2==e?(u.text("Player won!"),d.addClass("attacker-header")):(d.addClass("defender-header"),u.text("AI won!")),c.off(),d.removeClass("hidden"),!0):!1}function i(){c=$("#board");for(var a="",t=0;g>t;t++){for(var n="<div class='row'>",o=0;m>o;o++)n+="<div><div data-val='0' class='empty' id='"+t+","+o+"'></div></div>";n+="</div>",a+=n}c.append(a),c.on("click",".row > div > div",e)}function r(e,a,n,o){var i=document.getElementById(a),r=$(i);r.attr("class",v[0]);var l=document.getElementById(n),c=$(l);if(c.attr("class",v[e]),o&&o[0])for(var d=0;d<o.length;d++){f=o[d][0],t=o[d][1];var s=document.getElementById(f+","+t);console.log(f+","+t);var u=$(s);u.attr("class",v[0])}}function l(e){e=e;for(var a=0;a<e.length;a++)for(var t=e[a].length,n=0;t>n;n++){var o=e[a][n],i=document.getElementById(a+","+n),r=$(i);r.attr("class",v[o])}}var c=$("#board"),d=$("#board_header"),s=$("#new_game"),u=$("#header_text");const g=9,m=9;var p=null;const v=["empty","attacker","defender","king"];return s.on("click",a),{empty_board:i,new_board:l,move:r,game_end:o,reset:n}}(),dialogs=function(){function e(){d.showModal()}function a(){s.showModal()}function t(){u.showModal()}function n(){d.close()}function o(){s.close()}function i(){u.close()}var r=$("#how"),l=$("#history"),c=$("#about"),d=document.getElementById("how-dialog"),s=document.getElementById("history-dialog"),u=document.getElementById("about-dialog");r.on("click",e),l.on("click",a),c.on("click",t),d.querySelector(".close").addEventListener("click",n),s.querySelector(".close").addEventListener("click",o),u.querySelector(".close").addEventListener("click",i)}(),google_apis=function(){function e(){gapi.client.hnefatafl.new_game().execute(function(e){o=e.key,board.new_board(JSON.parse(e.board)),n()})}function a(){gapi.client.hnefatafl.last_player_game().execute(function(a){if(404==a.code)e();else{o=a.key,board.new_board(JSON.parse(a.board));var t=parseInt(a.state);board.game_end(t)||1==t&&n()}})}function t(e,a){i.addClass("loading");var t=e.split(","),r=a.split(",");try{gapi.client.hnefatafl.player_move({game_key:o,origin_row:t[0],origin_column:t[1],destination_row:r[0],destination_column:r[1]}).execute(function(e){board.reset();var a="[]"!=e.captures?e.captures.replace(/\(/g,"[").replace(/\)/g,"]").replace(/ /g,""):null;console.log(e),e.code||(board.move(e.origin_value,e.origin,e.destination,JSON.parse(a)),board.game_end(parseInt(e.game_state))?i.removeClass("loading"):n())})}catch(l){}finally{}}function n(){gapi.client.hnefatafl.ai_move({game_key:o}).execute(function(e){var a="[]"!=e.captures?e.captures.replace(/\(/g,"[").replace(/\)/g,"]").replace(/ /g,""):null;console.log(e),board.move(e.origin_value,e.origin,e.destination,JSON.parse(a)),board.game_end(parseInt(e.game_state)),i.removeClass("loading")})}var o=null,i=$("#loader");return{new_game:e,player_move:t,ai_move:n,last_player_game:a}}(),google_auth=function(){function e(){gapi.client.load("oauth2","v2"),gapi.client.load("hnefatafl","v1",a,i)}function a(){t(immediate=!0),setTimeout(profile.enableLogin(),2e3)}function t(e){gapi.auth.authorize({client_id:"314272160250-ucrqg44c1oj9knlrfatqvqf1b3pm9819.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/userinfo.email",immediate:e},o)}function n(){return r}function o(e){gapi.client.oauth2.userinfo.get().execute(function(e){e.code||(profile.setLoggedIn(e.picture,e.name),r=!0,google_apis.last_player_game())})}const i="https://hnefatafl-game.appspot.com/_ah/api";var r=!1;return{loadModules:e,isAuthed:n,signin:t}}(),profile=function(){function e(){n.on("click",a),n.removeClass("hidden")}function a(){google_auth.signin(immediate=!1)}function t(e,a){o.html(a),o.removeClass("hidden"),n.addClass("hidden")}var n=$("#login"),o=$("#name");return{enableLogin:e,setLoggedIn:t}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvYXJkLmpzIiwiZGlhbG9ncy5qcyIsImdvb2dsZV9hcGkuanMiLCJnb29nbGVfYXV0aC5qcyIsInByb2ZpbGUuanMiXSwibmFtZXMiOlsiYm9hcmQiLCJvbkNsaWNrIiwiJGNlbGwiLCIkIiwidGhpcyIsInR5cGUiLCJhdHRyIiwiJHNlbGVjdGVkIiwiZ29vZ2xlX2FwaXMiLCJwbGF5ZXJfbW92ZSIsIm5ld19nYW1lIiwiJGJvYXJkIiwib24iLCIkYm9hcmRfaGVhZGVyIiwiYWRkQ2xhc3MiLCJyZXNldCIsImdhbWVfZW5kIiwiZ2FtZV9zdGF0ZSIsIiRoZWFkZXJfdGV4dCIsInRleHQiLCJvZmYiLCJyZW1vdmVDbGFzcyIsImVtcHR5X2JvYXJkIiwidGFibGVfYnVpbGRlciIsInJvdyIsIkhFSUdIVCIsInJvd19idWlsZGVyIiwiY29sIiwiV0lEVEgiLCJhcHBlbmQiLCJtb3ZlIiwib3JpZ2luX3ZhbHVlIiwib3JpZ2luIiwiZGVzdGluYXRpb24iLCJjYXB0dXJlcyIsIm9yIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIiRvciIsInR5cGVOYW1lcyIsImRlIiwiJGRlIiwiaSIsImxlbmd0aCIsImYiLCJ0IiwiY2EiLCJjb25zb2xlIiwibG9nIiwiJGNhIiwibmV3X2JvYXJkIiwiY29sdW1uV2lkdGgiLCJ2YWwiLCIkbmV3X2dhbWUiLCJkaWFsb2dzIiwib3BlbkhvdyIsImhvd19kaWFsb2ciLCJzaG93TW9kYWwiLCJvcGVuSGlzdG9yeSIsImhpc3RvcnlfZGlhbG9nIiwib3BlbkFib3V0IiwiYWJvdXRfZGlhbG9nIiwiY2xvc2VIb3ciLCJjbG9zZSIsImNsb3NlSGlzdG9yeSIsImNsb3NlQWJvdXQiLCIkaG93IiwiJGhpc3RvcnkiLCIkYWJvdXQiLCJxdWVyeVNlbGVjdG9yIiwiYWRkRXZlbnRMaXN0ZW5lciIsImdhcGkiLCJjbGllbnQiLCJobmVmYXRhZmwiLCJleGVjdXRlIiwicmVzcG9uc2UiLCJLRVkiLCJrZXkiLCJKU09OIiwicGFyc2UiLCJhaV9tb3ZlIiwibGFzdF9wbGF5ZXJfZ2FtZSIsImNvZGUiLCJzdGF0ZSIsInBhcnNlSW50IiwiJGxvYWRlciIsIm9yaWdpbnMiLCJzcGxpdCIsImRlc3RpbmF0aW9ucyIsImdhbWVfa2V5Iiwib3JpZ2luX3JvdyIsIm9yaWdpbl9jb2x1bW4iLCJkZXN0aW5hdGlvbl9yb3ciLCJkZXN0aW5hdGlvbl9jb2x1bW4iLCJyZXBsYWNlIiwiZXJyIiwiZ29vZ2xlX2F1dGgiLCJsb2FkTW9kdWxlcyIsImxvYWQiLCJhZnRlckxvYWRlZCIsInVybCIsInNpZ25pbiIsImltbWVkaWF0ZSIsInNldFRpbWVvdXQiLCJwcm9maWxlIiwiZW5hYmxlTG9naW4iLCJhdXRoIiwiYXV0aG9yaXplIiwiY2xpZW50X2lkIiwic2NvcGUiLCJ1c2VyQXV0aGVkIiwiaXNBdXRoZWQiLCJzaWduZWRpbiIsIm1vZGUiLCJvYXV0aDIiLCJ1c2VyaW5mbyIsImdldCIsInJlc3AiLCJzZXRMb2dnZWRJbiIsInBpY3R1cmUiLCJuYW1lIiwiJGxvZ2luIiwiX2xvZ2luQ2xpY2siLCJzcmMiLCIkbmFtZSIsImh0bWwiXSwibWFwcGluZ3MiOiJBQUFBLEdBQUFBLE9BQUEsV0FxQkEsUUFBQUMsS0FDQSxHQUFBQyxHQUFBQyxFQUFBQyxNQUNBQyxFQUFBSCxFQUFBSSxLQUFBLFFBRUEsSUFBQSxZQUFBRCxFQUNBRSxHQUNBQSxFQUFBRCxLQUFBLFFBQUEsWUFDQUMsRUFBQSxPQUdBTCxFQUFBSSxLQUFBLFFBQUEsbUJBQ0FDLEVBQUFMLE9BR0EsSUFBQUssRUFDQSxHQUFBLFNBQUFGLEVBQ0EsQ0FBQUcsWUFBQUMsWUFDQUYsRUFBQUQsS0FBQSxNQUNBSixFQUFBSSxLQUFBLFdBSUFDLEdBQUFELEtBQUEsUUFBQSxZQUNBQyxFQUFBLEtBSUEsUUFBQUcsS0FDQUMsRUFBQUMsR0FBQSxRQUFBLG1CQUFBWCxHQUNBTyxZQUFBRSxXQUNBRyxFQUFBQyxTQUFBLFVBUUEsUUFBQUMsS0FDQVIsSUFDQUEsRUFBQUQsS0FBQSxRQUFBLFlBQ0FDLEVB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LFFBQUFDLEtBQ0FnQixFQUFBN0csR0FBQSxRQUFBOEcsR0FDQUQsRUFBQXBHLFlBQUEsVUFFQSxRQUFBcUcsS0FDQTFCLFlBQUFLLE9BQUFDLFdBQUEsR0FLQSxRQUFBZ0IsR0FBQUssRUFBQUgsR0FDQUksRUFBQUMsS0FBQUwsR0FDQUksRUFBQXZHLFlBQUEsVUFDQW9HLEVBQUEzRyxTQUFBLFVBakJBLEdBQUEyRyxHQUFBdEgsRUFBQSxVQUVBeUgsRUFBQXpILEVBQUEsUUFpQkEsUUFDQXNHLFlBQUFBLEVBQ0FhLFlBQUFBIiwiZmlsZSI6InNjcmlwdHMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGJvYXJkID0gKGZ1bmN0aW9uKCkge1xuXG4gICB2YXIgJGJvYXJkID0gJChcIiNib2FyZFwiKTtcbiAgIHZhciAkYm9hcmRfaGVhZGVyID0gJChcIiNib2FyZF9oZWFkZXJcIik7XG4gICB2YXIgJG5ld19nYW1lID0gJChcIiNuZXdfZ2FtZVwiKTtcbiAgIHZhciAkaGVhZGVyX3RleHQgPSAkKFwiI2hlYWRlcl90ZXh0XCIpO1xuXG4gICBjb25zdCBIRUlHSFQgPSA5O1xuICAgY29uc3QgV0lEVEggPSA5O1xuXG4gICB2YXIgYm9hcmQ7XG5cbiAgIHZhciAkc2VsZWN0ZWQgPSBudWxsO1xuXG4gICBjb25zdCB0eXBlTmFtZXMgPSBbXG4gICAgICAnZW1wdHknLFxuICAgICAgJ2F0dGFja2VyJyxcbiAgICAgICdkZWZlbmRlcicsXG4gICAgICAna2luZydcbiAgIF07XG5cbiAgIGZ1bmN0aW9uIG9uQ2xpY2soKSB7XG4gICAgICB2YXIgJGNlbGwgPSAkKHRoaXMpO1xuICAgICAgdmFyIHR5cGUgPSAkY2VsbC5hdHRyKCdjbGFzcycpO1xuXG4gICAgICBpZih0eXBlID09IFwiYXR0YWNrZXJcIikge1xuICAgICAgICAgaWYoJHNlbGVjdGVkKSB7XG4gICAgICAgICAgICAkc2VsZWN0ZWQuYXR0cignY2xhc3MnLCdhdHRhY2tlcicpO1xuICAgICAgICAgICAgJHNlbGVjdGVkID0gbnVsbDtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJGNlbGwuYXR0cignY2xhc3MnLCdhdHRhY2tlci1zZWxlY3QnKTtcbiAgICAgICAgICAgICRzZWxlY3RlZCA9ICRjZWxsO1xuICAgICAgICAgfVxuICAgICAgfVxuICAgICAgZWxzZSBpZigkc2VsZWN0ZWQpe1xuICAgICAgICAgaWYodHlwZSA9PSBcImVtcHR5XCIpIHtcbiAgICAgICAgICAgIHZhciByZXN1bHQgPSBnb29nbGVfYXBpcy5wbGF5ZXJfbW92ZShcbiAgICAgICAgICAgICAgICRzZWxlY3RlZC5hdHRyKCdpZCcpLFxuICAgICAgICAgICAgICAgJGNlbGwuYXR0cignaWQnKVxuICAgICAgICAgICAgKTtcbiAgICAgICAgIH1cbiAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgJHNlbGVjdGVkLmF0dHIoJ2NsYXNzJywnYXR0YWNrZXInKTtcbiAgICAgICAgICAgICRzZWxlY3RlZCA9IG51bGw7XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG4gICBmdW5jdGlvbiBuZXdfZ2FtZSgpIHtcbiAgICAgICRib2FyZC5vbignY2xpY2snLCcucm93ID4gZGl2ID4gZGl2Jywgb25DbGljayk7XG4gICAgICBnb29nbGVfYXBpcy5uZXdfZ2FtZSgpO1xuICAgICAgJGJvYXJkX2hlYWRlci5hZGRDbGFzcygnaGlkZGVuJyk7XG4gICB9XG4gICAkbmV3X2dhbWUub24oJ2NsaWNrJyxuZXdfZ2FtZSk7XG5cbiAgIGZ1bmN0aW9uIGNlbGxDbGljayh0YXJnZXQsIHBhcmFtcykge1xuXG4gICB9XG5cbiAgIGZ1bmN0aW9uIHJlc2V0KCkge1xuICAgICAgaWYoJHNlbGVjdGVkKSB7XG4gICAgICAgICAkc2VsZWN0ZWQuYXR0cignY2xhc3MnLCdhdHRhY2tlcicpO1xuICAgICAgICAgJHNlbGVjdGVkID0gbnVsbDtcbiAgICAgIH1cbiAgIH1cblxuICAgZnVuY3Rpb24gZ2FtZV9lbmQoZ2FtZV9zdGF0ZSkge1xuICAgICAgaWYoZ2FtZV9zdGF0ZSA9PSAyIHx8IGdhbWVfc3RhdGUgPT0gMykge1xuICAgICAgICAgaWYoZ2FtZV9zdGF0ZSA9PSAyKXtcbiAgICAgICAgICAgICRoZWFkZXJfdGV4dC50ZXh0KFwiUGxheWVyIHdvbiFcIik7XG4gICAgICAgICAgICAkYm9hcmRfaGVhZGVyLmFkZENsYXNzKFwiYXR0YWNrZXItaGVhZGVyXCIpO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgJGJvYXJkX2hlYWRlci5hZGRDbGFzcyhcImRlZmVuZGVyLWhlYWRlclwiKTtcbiAgICAgICAgICAgICAkaGVhZGVyX3RleHQudGV4dChcIkFJIHdvbiFcIik7XG4gICAgICAgICAgfVxuICAgICAgICAgJGJvYXJkLm9mZigpO1xuICAgICAgICAgJGJvYXJkX2hlYWRlci5yZW1vdmVDbGFzcygnaGlkZGVuJyk7XG4gICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBmYWxzZTtcbiAgIH1cblxuICAgZnVuY3Rpb24gZW1wdHlfYm9hcmQoKSB7XG5cbiAgICAgICRib2FyZCA9ICQoXCIjYm9hcmRcIik7XG4gICAgICB2YXIgdGFibGVfYnVpbGRlciA9IFwiXCI7XG4gICBcdGZvcih2YXIgcm93PTA7IHJvdzwgSEVJR0hUOyByb3crKyl7XG4gICAgICAgICB2YXIgcm93X2J1aWxkZXIgPSBcIjxkaXYgY2xhc3M9J3Jvdyc+XCI7XG4gICBcdFx0Zm9yKHZhciBjb2w9MDsgY29sPCBXSURUSDsgY29sKyspIHtcbiAgICAgICAgICAgIHJvd19idWlsZGVyICs9IFwiPGRpdj48ZGl2IGRhdGEtdmFsPScwJyBjbGFzcz0nZW1wdHknIGlkPSdcIiArIHJvdyArIFwiLFwiICsgY29sICsgXCInPjwvZGl2PjwvZGl2PlwiO1xuICAgXHRcdH1cbiAgICAgICAgIHJvd19idWlsZGVyICs9IFwiPC9kaXY+XCI7XG5cbiAgICAgICAgIHRhYmxlX2J1aWxkZXIgKz0gcm93X2J1aWxkZXI7XG4gICBcdH1cblxuICAgICAgJGJvYXJkLmFwcGVuZCh0YWJsZV9idWlsZGVyKTtcblxuICAgICAgJGJvYXJkLm9uKCdjbGljaycsJy5yb3cgPiBkaXYgPiBkaXYnLCBvbkNsaWNrKTtcblxuICAgfVxuXG4gICBmdW5jdGlvbiBmYWRlSW5OZXdDbGFzcyhzb3VyY2UsIGZyb21fY2xhc3MsIHRvX2NsYXNzKSB7XG4gICAgICBzb3VyY2Uuc3dpdGNoQ2xhc3MoZnJvbV9jbGFzcywgdG9fY2xhc3MsIDEwMDApO1xuICAgfVxuXG4gICBmdW5jdGlvbiBtb3ZlKG9yaWdpbl92YWx1ZSwgb3JpZ2luLCBkZXN0aW5hdGlvbiwgY2FwdHVyZXMpIHtcblxuXG5cbiAgICAgIHZhciBvciA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG9yaWdpbik7XG4gICAgICB2YXIgJG9yID0gJChvcik7XG4gICAgICAkb3IuYXR0cignY2xhc3MnLHR5cGVOYW1lc1swXSk7XG5cbiAgICAgIHZhciBkZSA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRlc3RpbmF0aW9uKTtcbiAgICAgIHZhciAkZGUgPSAkKGRlKTtcbiAgICAgICRkZS5hdHRyKCdjbGFzcycsdHlwZU5hbWVzW29yaWdpbl92YWx1ZV0pO1xuXG4gICAgICBpZihjYXB0dXJlcyAmJiBjYXB0dXJlc1swXSkge1xuXG4gICAgICAgICBmb3IodmFyIGk9MDsgaTwgY2FwdHVyZXMubGVuZ3RoOyBpKyspIHtcblxuICAgICAgICAgICAgZiA9IGNhcHR1cmVzW2ldWzBdO1xuICAgICAgICAgICAgdCA9IGNhcHR1cmVzW2ldWzFdO1xuICAgICAgICAgICAgdmFyIGNhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZiArIFwiLFwiICsgdCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhmICsgXCIsXCIgKyB0KTtcbiAgICAgICAgICAgIHZhciAkY2EgPSAkKGNhKTtcbiAgICAgICAgICAgICRjYS5hdHRyKCdjbGFzcycsdHlwZU5hbWVzWzBdKTtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cblxuICAgZnVuY3Rpb24gbmV3X2JvYXJkKGJvYXJkKSB7XG4gICAgICBib2FyZCA9IGJvYXJkO1xuICAgXHRmb3IodmFyIHJvdz0wOyByb3cgPCBib2FyZC5sZW5ndGg7IHJvdysrKXtcbiAgICAgICAgIHZhciBjb2x1bW5XaWR0aCA9IGJvYXJkW3Jvd10ubGVuZ3RoO1xuICAgXHRcdGZvcih2YXIgY29sPTA7IGNvbCA8IGNvbHVtbldpZHRoOyBjb2wrKykge1xuICAgICAgICAgICAgdmFyIHZhbCA9IGJvYXJkW3Jvd11bY29sXTtcblxuICAgICAgICAgICAgICAgdmFyIHQgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChyb3cgKyBcIixcIiArIGNvbCk7XG5cbiAgICAgICAgICAgICAgIHZhciAkY2VsbCA9ICQodCk7XG5cbiAgICAgICAgICAgICAgICRjZWxsLmF0dHIoJ2NsYXNzJyx0eXBlTmFtZXNbdmFsXSk7XG5cbiAgIFx0XHR9XG4gICBcdH1cblxuICAgfVxuXG4gICBmdW5jdGlvbiBtYWtlX21vdmUoZnJvbV9yLCBmcm9tX2MsIHRvX3IsIHRvX2MsIGNhcHR1cmVzLCB2YWx1ZSkge1xuXG4gICAgICBib2FyZFtmcm9tX3JdW2Zyb21fY10gPSAwO1xuICAgICAgYm9hcmRbdG9fcl1bdG9fY10gPSB2YWx1ZTtcbiAgICAgICQoXCIjXCIgKyBmcm9tX3IgKyBcIixcIiArIGZyb21fYykuYXR0cignY2xhc3MnLCdlbXB0eScpO1xuICAgICAgJChcIiNcIiArIHRvX3IgKyBcIixcIiArIHRvX2MpLmF0dHIoJ2NsYXNzJyx0eXBlTmFtZXNbdmFsdWVdKTtcbiAgICAgIGZvcih2YXIgY2FwdHVyZSBpbiBjYXB0dXJlcykge1xuICAgICAgICAgdmFyIHIgPSBjYXB0dXJlWzBdO1xuICAgICAgICAgdmFyIGMgPSBjYXB0dXJlWzFdO1xuICAgICAgICAgYm9hcmRbcl1bY10gPSAwO1xuICAgICAgICAgJChcIiNcIiArIHIgKyBcIixcIiArIGMpLmF0dHIoJ2NsYXNzJywnZW1wdHknKTtcbiAgICAgIH1cblxuICAgfVxuXG4gICByZXR1cm4ge1xuICAgICAgZW1wdHlfYm9hcmQ6IGVtcHR5X2JvYXJkLFxuICAgICAgbmV3X2JvYXJkOiBuZXdfYm9hcmQsXG4gICAgICBtb3ZlOiBtb3ZlLFxuICAgICAgZ2FtZV9lbmQ6IGdhbWVfZW5kLFxuICAgICAgcmVzZXQ6IHJlc2V0XG4gICB9O1xufSkoKTtcbiIsInZhciBkaWFsb2dzID0gKGZ1bmN0aW9uKCl7XG5cbiAgIHZhciAkaG93ID0gJChcIiNob3dcIik7XG4gICB2YXIgJGhpc3RvcnkgPSAkKFwiI2hpc3RvcnlcIik7XG4gICB2YXIgJGFib3V0ID0gJChcIiNhYm91dFwiKTtcblxuICAgdmFyIGhvd19kaWFsb2cgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnaG93LWRpYWxvZycpO1xuICAgdmFyIGhpc3RvcnlfZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hpc3RvcnktZGlhbG9nJyk7XG4gICB2YXIgYWJvdXRfZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2Fib3V0LWRpYWxvZycpO1xuXG4gICBmdW5jdGlvbiBvcGVuSG93KCl7XG4gICAgICBob3dfZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBvcGVuSGlzdG9yeSgpIHtcbiAgICAgIGhpc3RvcnlfZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBvcGVuQWJvdXQoKSB7XG4gICAgICBhYm91dF9kaWFsb2cuc2hvd01vZGFsKCk7XG4gICB9XG5cbiAgIGZ1bmN0aW9uIGNsb3NlSG93KCkge1xuICAgICAgaG93X2RpYWxvZy5jbG9zZSgpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBjbG9zZUhpc3RvcnkoKSB7XG4gICAgICBoaXN0b3J5X2RpYWxvZy5jbG9zZSgpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBjbG9zZUFib3V0KCkge1xuICAgICAgYWJvdXRfZGlhbG9nLmNsb3NlKCk7XG4gICB9XG5cbiAgICRob3cub24oJ2NsaWNrJywgb3Blbkhvdyk7XG4gICAkaGlzdG9yeS5vbignY2xpY2snLCBvcGVuSGlzdG9yeSk7XG4gICAkYWJvdXQub24oJ2NsaWNrJywgb3BlbkFib3V0KTtcblxuICAgaG93X2RpYWxvZy5xdWVyeVNlbGVjdG9yKCcuY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlSG93KTtcbiAgIGhpc3RvcnlfZGlhbG9nLnF1ZXJ5U2VsZWN0b3IoJy5jbG9zZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgY2xvc2VIaXN0b3J5KTtcbiAgIGFib3V0X2RpYWxvZy5xdWVyeVNlbGVjdG9yKCcuY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlQWJvdXQpO1xuXG59KSgpO1xuIiwidmFyIGdvb2dsZV9hcGlzID0gKGZ1bmN0aW9uKCkge1xuXG4gICB2YXIgS0VZID0gbnVsbDtcbiAgIHZhciAkbG9hZGVyID0gJChcIiNsb2FkZXJcIik7XG5cbiAgIGZ1bmN0aW9uIG5ld19nYW1lKCkge1xuICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLm5ld19nYW1lKCkuZXhlY3V0ZShmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgIEtFWSA9IHJlc3BvbnNlLmtleTtcbiAgICAgICAgIGJvYXJkLm5ld19ib2FyZChKU09OLnBhcnNlKHJlc3BvbnNlLmJvYXJkKSk7XG4gICAgICAgICBhaV9tb3ZlKCk7XG4gICAgICB9KTtcbiAgIH1cblxuICAgZnVuY3Rpb24gbGFzdF9wbGF5ZXJfZ2FtZSgpIHtcblxuICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLmxhc3RfcGxheWVyX2dhbWUoKS5leGVjdXRlKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgIGlmKHJlc3BvbnNlLmNvZGUgPT0gNDA0KSB7XG4gICAgICAgICAgICBuZXdfZ2FtZSgpO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBLRVkgPSByZXNwb25zZS5rZXk7XG4gICAgICAgICAgICBib2FyZC5uZXdfYm9hcmQoSlNPTi5wYXJzZShyZXNwb25zZS5ib2FyZCkpO1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gcGFyc2VJbnQocmVzcG9uc2Uuc3RhdGUpO1xuICAgICAgICAgICAgaWYoIWJvYXJkLmdhbWVfZW5kKHN0YXRlKSlcbiAgICAgICAgICAgICAgIGlmKHN0YXRlID09IDEpIGFpX21vdmUoKTtcbiAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgfVxuXG4gICBmdW5jdGlvbiBwbGF5ZXJfbW92ZShvcmlnaW4sIGRlc3RpbmF0aW9uKSB7XG4gICAgICAkbG9hZGVyLmFkZENsYXNzKCdsb2FkaW5nJyk7XG4gICAgICB2YXIgb3JpZ2lucyA9IG9yaWdpbi5zcGxpdCgnLCcpO1xuICAgICAgdmFyIGRlc3RpbmF0aW9ucyA9IGRlc3RpbmF0aW9uLnNwbGl0KCcsJyk7XG5cblxuICAgICAgdHJ5XG4gICAgICB7XG4gICAgICAgICBnYXBpLmNsaWVudC5obmVmYXRhZmwucGxheWVyX21vdmUoe1xuICAgICAgICAgICAgXCJnYW1lX2tleVwiOiBLRVksXG4gICAgICAgICAgICBcIm9yaWdpbl9yb3dcIjogb3JpZ2luc1swXSxcbiAgICAgICAgICAgIFwib3JpZ2luX2NvbHVtblwiOiBvcmlnaW5zWzFdLFxuICAgICAgICAgICAgXCJkZXN0aW5hdGlvbl9yb3dcIjogZGVzdGluYXRpb25zWzBdLFxuICAgICAgICAgICAgXCJkZXN0aW5hdGlvbl9jb2x1bW5cIjogZGVzdGluYXRpb25zWzFdXG4gICAgICAgICB9KS5leGVjdXRlKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIGJvYXJkLnJlc2V0KCk7XG4gICAgICAgICAgICB2YXIgY2FwdHVyZXMgPSByZXNwb25zZS5jYXB0dXJlcyAhPSBcIltdXCIgP1xuICAgICAgICAgICAgICAgcmVzcG9uc2UuY2FwdHVyZXMucmVwbGFjZSgvXFwoL2csJ1snKS5yZXBsYWNlKC9cXCkvZywnXScpLnJlcGxhY2UoLyAvZywnJykgOlxuICAgICAgICAgICAgICAgbnVsbDtcbiAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlKTtcbiAgICAgICAgICAgIGlmKCFyZXNwb25zZS5jb2RlKSAge1xuICAgICAgICAgICAgICAgYm9hcmQubW92ZShcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbl92YWx1ZSxcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbixcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgICAgSlNPTi5wYXJzZShjYXB0dXJlcylcbiAgICAgICAgICAgICAgICk7XG4gICAgICAgICAgICAgICBpZighYm9hcmQuZ2FtZV9lbmQocGFyc2VJbnQocmVzcG9uc2UuZ2FtZV9zdGF0ZSkpKSB7XG4gICAgICAgICAgICAgICAgICBhaV9tb3ZlKCk7XG4gICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICRsb2FkZXIucmVtb3ZlQ2xhc3MoJ2xvYWRpbmcnKTtcbiAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgY2F0Y2goZXJyKSB7XG5cbiAgICAgIH1cbiAgICAgIGZpbmFsbHkge1xuXG4gICAgICB9XG4gICB9XG5cbiAgICAgIGZ1bmN0aW9uIGFpX21vdmUoKSB7XG4gICAgICAgICBnYXBpLmNsaWVudC5obmVmYXRhZmwuYWlfbW92ZSh7XG4gICAgICAgICAgICBcImdhbWVfa2V5XCI6S0VZXG4gICAgICAgICB9KS5leGVjdXRlKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgICAgIHZhciBjYXB0dXJlcyA9IHJlc3BvbnNlLmNhcHR1cmVzICE9IFwiW11cIiA/XG4gICAgICAgICAgICAgICByZXNwb25zZS5jYXB0dXJlcy5yZXBsYWNlKC9cXCgvZywnWycpLnJlcGxhY2UoL1xcKS9nLCddJykucmVwbGFjZSgvIC9nLCcnKSA6XG4gICAgICAgICAgICAgICBudWxsO1xuICAgICAgICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UpO1xuICAgICAgICAgICAgYm9hcmQubW92ZShcbiAgICAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbl92YWx1ZSxcbiAgICAgICAgICAgICAgIHJlc3BvbnNlLm9yaWdpbixcbiAgICAgICAgICAgICAgIHJlc3BvbnNlLmRlc3RpbmF0aW9uLFxuICAgICAgICAgICAgICAgSlNPTi5wYXJzZShjYXB0dXJlcylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBib2FyZC5nYW1lX2VuZChwYXJzZUludChyZXNwb25zZS5nYW1lX3N0YXRlKSk7XG4gICAgICAgICAgICAkbG9hZGVyLnJlbW92ZUNsYXNzKCdsb2FkaW5nJyk7XG4gICAgICAgICB9KTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB7XG4gICAgICAgICBuZXdfZ2FtZTogbmV3X2dhbWUsXG4gICAgICAgICBwbGF5ZXJfbW92ZTogcGxheWVyX21vdmUsXG4gICAgICAgICBhaV9tb3ZlOiBhaV9tb3ZlLFxuICAgICAgICAgbGFzdF9wbGF5ZXJfZ2FtZTogbGFzdF9wbGF5ZXJfZ2FtZVxuICAgICAgfTtcbn0pKCk7XG4iLCJ2YXIgZ29vZ2xlX2F1dGggPSAoZnVuY3Rpb24oKXtcblxuICAgLy9jb25zdCB1cmwgPSBcImh0dHA6Ly9sb2NhbGhvc3Q6ODA4MC9fYWgvYXBpXCI7XG4gICBjb25zdCB1cmwgPSBcImh0dHBzOi8vaG5lZmF0YWZsLWdhbWUuYXBwc3BvdC5jb20vX2FoL2FwaVwiO1xuICAgdmFyIHNpZ25lZGluID0gZmFsc2U7XG5cbiAgIGZ1bmN0aW9uIGxvYWRNb2R1bGVzKCl7XG4gICAgICBnYXBpLmNsaWVudC5sb2FkKFxuICAgICAgICAgJ29hdXRoMicsXG4gICAgICAgICAndjInXG4gICAgICApO1xuICAgICAgZ2FwaS5jbGllbnQubG9hZChcbiAgICAgICAgICdobmVmYXRhZmwnLFxuICAgICAgICAgJ3YxJyxcbiAgICAgICAgIGFmdGVyTG9hZGVkLFxuICAgICAgICAgdXJsXG4gICAgICApO1xuICAgfVxuXG4gICBmdW5jdGlvbiBhZnRlckxvYWRlZCgpIHtcbiAgICAgIHNpZ25pbihpbW1lZGlhdGUgPSB0cnVlKTtcbiAgICAgIHNldFRpbWVvdXQocHJvZmlsZS5lbmFibGVMb2dpbigpLCAyMDAwKTtcblxuICAgfVxuXG4gICBmdW5jdGlvbiBzaWduaW4oaW1tZWRpYXRlKSB7XG4gICAgICBnYXBpLmF1dGguYXV0aG9yaXplKHtcbiAgICAgICAgIGNsaWVudF9pZDogJzMxNDI3MjE2MDI1MC11Y3JxZzQ0YzFvajlrbmxyZmF0cXZxZjFiM3BtOTgxOS5hcHBzLmdvb2dsZXVzZXJjb250ZW50LmNvbScsXG4gICAgICAgICBzY29wZTogJ2h0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL2F1dGgvdXNlcmluZm8uZW1haWwnLFxuICAgICAgICAgaW1tZWRpYXRlOiBpbW1lZGlhdGVcbiAgICAgIH0sIHVzZXJBdXRoZWQpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBpc0F1dGhlZCgpIHtcbiAgICAgIHJldHVybiBzaWduZWRpbjtcbiAgIH1cblxuICAgZnVuY3Rpb24gdXNlckF1dGhlZChtb2RlKSB7XG4gICAgICB2YXIgcmVxdWVzdCA9IGdhcGkuY2xpZW50Lm9hdXRoMi51c2VyaW5mby5nZXQoKS5leGVjdXRlKGZ1bmN0aW9uKHJlc3ApIHtcbiAgICAgICAgIGlmICghcmVzcC5jb2RlKSB7XG4gICAgICAgICAgICBwcm9maWxlLnNldExvZ2dlZEluKHJlc3AucGljdHVyZSwgcmVzcC5uYW1lKTtcbiAgICAgICAgICAgIHNpZ25lZGluID0gdHJ1ZTtcbiAgICAgICAgICAgIC8vZ29vZ2xlX2FwaXMubmV3X2dhbWUoZ29vZ2xlX2FwaXMuYWlfbW92ZSk7XG4gICAgICAgICAgICBnb29nbGVfYXBpcy5sYXN0X3BsYXllcl9nYW1lKCk7XG4gICAgICAgICAvLyAgIGdvb2dsZV9hcGlzLmFpX21vdmUoKTtcbiAgICAgICAgICB9XG4gICAgIH0pO1xuICAgfVxuICAgcmV0dXJuIHtcbiAgICAgIGxvYWRNb2R1bGVzOiBsb2FkTW9kdWxlcyxcbiAgICAgIGlzQXV0aGVkOiBpc0F1dGhlZCxcbiAgICAgIHNpZ25pbjogc2lnbmluXG4gICB9O1xuXG59KSgpO1xuIiwidmFyIHByb2ZpbGUgPSAoZnVuY3Rpb24oKSB7XG4gICB2YXIgJGxvZ2luID0gJChcIiNsb2dpblwiKTtcbiAgIC8vdmFyICRwaWN0dXJlID0gJChcIiNwaWN0dXJlXCIpO1xuICAgdmFyICRuYW1lID0gJChcIiNuYW1lXCIpO1xuXG4gICBmdW5jdGlvbiBlbmFibGVMb2dpbigpIHtcbiAgICAgICRsb2dpbi5vbignY2xpY2snLCBfbG9naW5DbGljayk7XG4gICAgICAkbG9naW4ucmVtb3ZlQ2xhc3MoXCJoaWRkZW5cIik7XG4gICB9XG4gICBmdW5jdGlvbiBfbG9naW5DbGljaygpIHtcbiAgICAgIGdvb2dsZV9hdXRoLnNpZ25pbihpbW1lZGlhdGUgPSBmYWxzZSk7XG4gICB9XG4gICBmdW5jdGlvbiBfbG9nb3V0Q2xpY2soKSB7XG4gICAgICAvL3NpbmdpbihpbW1lZGlhdGUgPSBmYWxzZSk7XG4gICB9XG4gICBmdW5jdGlvbiBzZXRMb2dnZWRJbihzcmMsIG5hbWUpIHtcbiAgICAgICRuYW1lLmh0bWwobmFtZSk7XG4gICAgICAkbmFtZS5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgICAgICRsb2dpbi5hZGRDbGFzcyhcImhpZGRlblwiKTtcbiAgIH1cbiAgIHJldHVybiB7XG4gICAgICBlbmFibGVMb2dpbjogZW5hYmxlTG9naW4sXG4gICAgICBzZXRMb2dnZWRJbjogc2V0TG9nZ2VkSW5cbiAgIH07XG59KSgpO1xuIl0sInNvdXJjZVJvb3QiOiIvc291cmNlLyJ9
