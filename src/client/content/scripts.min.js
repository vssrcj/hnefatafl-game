var board=function(){function e(){var e=$(this),t=e.attr("class");if("attacker"==t)p?(p.attr("class","attacker"),p=null):(e.attr("class","attacker-select"),p=e);else if(p)if("empty"==t){google_apis.player_move(p.attr("id"),e.attr("id"))}else p.attr("class","attacker"),p=null}function a(){c.on("click",".row > div > div",e),google_apis.new_game(),d.addClass("hidden")}function n(){p&&(p.attr("class","attacker"),p=null)}function o(e){return 2==e||3==e?(2==e?(u.text("Player won!"),d.addClass("attacker-header")):(d.addClass("defender-header"),u.text("AI won!")),c.off(),d.removeClass("hidden"),!0):!1}function i(){c=$("#board");for(var t="",a=0;g>a;a++){for(var n="<div class='row'>",o=0;m>o;o++)n+="<div><div data-val='0' class='empty' id='"+a+","+o+"'></div></div>";n+="</div>",t+=n}c.append(t),c.on("click",".row > div > div",e)}function r(e,a,n,o){var i=document.getElementById(a),r=$(i);r.attr("class",v[0]);var l=document.getElementById(n),c=$(l);if(c.attr("class",v[e]),o&&o[0])for(var d=0;d<o.length;d++){f=o[d][0],t=o[d][1];var s=document.getElementById(f+","+t),u=$(s);u.attr("class",v[0])}}function l(e){e=e;for(var t=0;t<e.length;t++)for(var a=e[t].length,n=0;a>n;n++){var o=e[t][n],i=document.getElementById(t+","+n),r=$(i);r.attr("class",v[o])}}var c=$("#board"),d=$("#board_header"),s=$("#new_game"),u=$("#header_text");const g=9,m=9;var p=null;const v=["empty","attacker","defender","king"];return s.on("click",a),{empty_board:i,new_board:l,move:r,game_end:o,reset:n}}(),dialogs=function(){function e(){d.showModal()}function t(){s.showModal()}function a(){u.showModal()}function n(){d.close()}function o(){s.close()}function i(){u.close()}var r=$("#how"),l=$("#history"),c=$("#about"),d=document.getElementById("how-dialog"),s=document.getElementById("history-dialog"),u=document.getElementById("about-dialog");r.on("click",e),l.on("click",t),c.on("click",a),d.querySelector(".close").addEventListener("click",n),s.querySelector(".close").addEventListener("click",o),u.querySelector(".close").addEventListener("click",i)}(),google_apis=function(){function e(){gapi.client.hnefatafl.new_game().execute(function(e){o=e.key,board.new_board(JSON.parse(e.board)),n()})}function t(){gapi.client.hnefatafl.last_player_game().execute(function(t){if(404==t.code)e();else{o=t.key,board.new_board(JSON.parse(t.board));var a=parseInt(t.state);board.game_end(a)||1==a&&n()}})}function a(e,t){var a=e.split(","),i=t.split(",");try{gapi.client.hnefatafl.player_move({game_key:o,origin_row:a[0],origin_column:a[1],destination_row:i[0],destination_column:i[1]}).execute(function(e){board.reset(),console.log(e),e.code||(board.move(e.origin_value,e.origin,e.destination,"[]"!=e.captures?JSON.parse(e.captures.replace("(","[").replace(")","]")):null),board.game_end(parseInt(e.game_state))||n())})}catch(r){}}function n(){gapi.client.hnefatafl.ai_move({game_key:o}).execute(function(e){console.log(e),board.move(e.origin_value,e.origin,e.destination,"[]"!=e.captures?JSON.parse(e.captures.replace("(","[").replace(")","]")):null),board.game_end(parseInt(e.game_state))})}var o=null;return{new_game:e,player_move:a,ai_move:n,last_player_game:t}}(),google_auth=function(){function e(){gapi.client.load("oauth2","v2"),gapi.client.load("hnefatafl","v1",t,i)}function t(){a(immediate=!0),setTimeout(profile.enableLogin(),2e3)}function a(e){gapi.auth.authorize({client_id:"314272160250-ucrqg44c1oj9knlrfatqvqf1b3pm9819.apps.googleusercontent.com",scope:"https://www.googleapis.com/auth/userinfo.email",immediate:e},o)}function n(){return r}function o(e){gapi.client.oauth2.userinfo.get().execute(function(e){e.code||(profile.setLoggedIn(e.picture,e.name),r=!0,google_apis.last_player_game())})}const i="https://hnefatafl-game.appspot.com/_ah/api";var r=!1;return{loadModules:e,isAuthed:n,signin:a}}(),profile=function(){function e(){n.on("click",t),n.removeClass("hidden")}function t(){google_auth.signin(immediate=!1)}function a(e,t){o.html(t),o.removeClass("hidden"),n.addClass("hidden")}var n=$("#login"),o=$("#name");return{enableLogin:e,setLoggedIn:a}}();
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImJvYXJkLmpzIiwiZGlhbG9ncy5qcyIsImdvb2dsZV9hcGkuanMiLCJnb29nbGVfYXV0aC5qcyIsInByb2ZpbGUuanMiXSwibmFtZXMiOlsiYm9hcmQiLCJvbkNsaWNrIiwiJGNlbGwiLCIkIiwidGhpcyIsInR5cGUiLCJhdHRyIiwiJHNlbGVjdGVkIiwiZ29vZ2xlX2FwaXMiLCJwbGF5ZXJfbW92ZSIsIm5ld19nYW1lIiwiJGJvYXJkIiwib24iLCIkYm9hcmRfaGVhZGVyIiwiYWRkQ2xhc3MiLCJyZXNldCIsImdhbWVfZW5kIiwiZ2FtZV9zdGF0ZSIsIiRoZWFkZXJfdGV4dCIsInRleHQiLCJvZmYiLCJyZW1vdmVDbGFzcyIsImVtcHR5X2JvYXJkIiwidGFibGVfYnVpbGRlciIsInJvdyIsIkhFSUdIVCIsInJvd19idWlsZGVyIiwiY29sIiwiV0lEVEgiLCJhcHBlbmQiLCJtb3ZlIiwib3JpZ2luX3ZhbHVlIiwib3JpZ2luIiwiZGVzdGluYXRpb24iLCJjYXB0dXJlcyIsIm9yIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsIiRvciIsInR5cGVOYW1lcyIsImRlIiwiJGRlIiwiaSIsImxlbmd0aCIsImYiLCJ0IiwiY2EiLCIkY2EiLCJuZXdfYm9hcmQiLCJjb2x1bW5XaWR0aCIsInZhbCIsIiRuZXdfZ2FtZSIsImRpYWxvZ3MiLCJvcGVuSG93IiwiaG93X2RpYWxvZyIsInNob3dNb2RhbCIsIm9wZW5IaXN0b3J5IiwiaGlzdG9yeV9kaWFsb2ciLCJvcGVuQWJvdXQiLCJhYm91dF9kaWFsb2ciLCJjbG9zZUhvdyIsImNsb3NlIiwiY2xvc2VIaXN0b3J5IiwiY2xvc2VBYm91dCIsIiRob3ciLCIkaGlzdG9yeSIsIiRhYm91dCIsInF1ZXJ5U2VsZWN0b3IiLCJhZGRFdmVudExpc3RlbmVyIiwiZ2FwaSIsImNsaWVudCIsImhuZWZhdGFmbCIsImV4ZWN1dGUiLCJyZXNwb25zZSIsIktFWSIsImtleSIsIkpTT04iLCJwYXJzZSIsImFpX21vdmUiLCJsYXN0X3BsYXllcl9nYW1lIiwiY29kZSIsInN0YXRlIiwicGFyc2VJbnQiLCJvcmlnaW5zIiwic3BsaXQiLCJkZXN0aW5hdGlvbnMiLCJnYW1lX2tleSIsIm9yaWdpbl9yb3ciLCJvcmlnaW5fY29sdW1uIiwiZGVzdGluYXRpb25fcm93IiwiZGVzdGluYXRpb25fY29sdW1uIiwiY29uc29sZSIsImxvZyIsInJlcGxhY2UiLCJlcnIiLCJnb29nbGVfYXV0aCIsImxvYWRNb2R1bGVzIiwibG9hZCIsImFmdGVyTG9hZGVkIiwidXJsIiwic2lnbmluIiwiaW1tZWRpYXRlIiwic2V0VGltZW91dCIsInByb2ZpbGUiLCJlbmFibGVMb2dpbiIsImF1dGgiLCJhdXRob3JpemUiLCJjbGllbnRfaWQiLCJzY29wZSIsInVzZXJBdXRoZWQiLCJpc0F1dGhlZCIsInNpZ25lZGluIiwibW9kZSIsIm9hdXRoMiIsInVzZXJpbmZvIiwiZ2V0IiwicmVzcCIsInNldExvZ2dlZEluIiwicGljdHVyZSIsIm5hbWUiLCIkbG9naW4iLCJfbG9naW5DbGljayIsInNyYyIsIiRuYW1lIiwiaHRtbCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBQUEsT0FBQSxXQXFCQSxRQUFBQyxLQUNBLEdBQUFDLEdBQUFDLEVBQUFDLE1BQ0FDLEVBQUFILEVBQUFJLEtBQUEsUUFFQSxJQUFBLFlBQUFELEVBQ0FFLEdBQ0FBLEVBQUFELEtBQUEsUUFBQSxZQUNBQyxFQUFBLE9BR0FMLEVBQUFJLEtBQUEsUUFBQSxtQkFDQUMsRUFBQUwsT0FHQSxJQUFBSyxFQUNBLEdBQUEsU0FBQUYsRUFDQSxDQUFBRyxZQUFBQyxZQUNBRixFQUFBRCxLQUFBLE1BQ0FKLEVBQUFJLEtBQUEsV0FJQUMsR0FBQUQsS0FBQSxRQUFBLFlBQ0FDLEVBQUEsS0FJQSxRQUFBRyxLQUNBQyxFQUFBQyxHQUFBLFFBQUEsbUJBQUFYLEdBQ0FPLFlBQUFFLFdBQ0FHLEVBQUFDLFNBQUEsVUFRQSxRQUFBQyxLQUNBUixJQUNBQSxFQUFBRCxLQUFBLFFBQUEsWUFDQUMsRUFBQSxNQUlBLFFBQUFTLEdBQUFDLEdBQ0EsTUFBQSxJQUFBQSxHQUFBLEdBQUFBLEdBQ0EsR0FBQUEsR0FDQUMsRUFBQUMsS0FBQSxlQUNBTixFQUFBQyxTQUFBLHFCQUdBRCxFQUFBQyxTQUFBLG1CQUNBSSxFQUFBQyxLQUFBLFlBRUFSLEVBQUFTLE1BQ0FQLEVBQUFRLFlBQUEsV0FDQSxJQUVBLEVBR0EsUUFBQUMsS0FFQVgsRUFBQVIsRUFBQSxTQUVBLEtBQUEsR0FEQW9CLEdBQUEsR0FDQUMsRUFBQSxFQUFBQyxFQUFBRCxFQUFBQSxJQUFBLENBRUEsSUFBQSxHQURBRSxHQUFBLG9CQUNBQyxFQUFBLEVBQUFDLEVBQUFELEVBQUFBLElBQ0FELEdBQUEsNENBQUFGLEVBQUEsSUFBQUcsRUFBQSxnQkFFQUQsSUFBQSxTQUVBSCxHQUFBRyxFQUdBZixFQUFBa0IsT0FBQU4sR0FFQVosRUFBQUMsR0FBQSxRQUFBLG1CQUFBWCxHQVFBLFFBQUE2QixHQUFBQyxFQUFBQyxFQUFBQyxFQUFBQyxHQUlBLEdBQUFDLEdBQUFDLFNBQUFDLGVBQUFMLEdBQ0FNLEVBQUFuQyxFQUFBZ0MsRUFDQUcsR0FBQWhDLEtBQUEsUUFBQWlDLEVBQUEsR0FFQSxJQUFBQyxHQUFBSixTQUFBQyxlQUFBSixHQUNBUSxFQUFBdEMsRUFBQXFDLEVBR0EsSUFGQUMsRUFBQW5DLEtBQUEsUUFBQWlDLEVBQUFSLElBRUFHLEdBQUFBLEVBQUEsR0FFQSxJQUFBLEdBQUFRLEdBQUEsRUFBQUEsRUFBQVIsRUFBQVMsT0FBQUQsSUFBQSxDQUNBRSxFQUFBVixFQUFBUSxHQUFBLEdBQ0FHLEVBQUFYLEVBQUFRLEdBQUEsRUFDQSxJQUFBSSxHQUFBVixTQUFBQyxlQUFBTyxFQUFBLElBQUFDLEdBQ0FFLEVBQUE1QyxFQUFBMkMsRUFDQUMsR0FBQXpDLEtBQUEsUUFBQWlDLEVBQUEsS0FLQSxRQUFBUyxHQUFBaEQsR0FDQUEsRUFBQUEsQ0FDQSxLQUFBLEdBQUF3QixHQUFBLEVBQUFBLEVBQUF4QixFQUFBMkMsT0FBQW5CLElBRUEsSUFBQSxHQURBeUIsR0FBQWpELEVBQUF3QixHQUFBbUIsT0FDQWhCLEVBQUEsRUFBQXNCLEVBQUF0QixFQUFBQSxJQUFBLENBQ0EsR0FBQXVCLEdBQUFsRCxFQUFBd0IsR0FBQUcsR0FFQWtCLEVBQUFULFNBQUFDLGVBQUFiLEVBQUEsSUFBQUcsR0FFQXpCLEVBQUFDLEVBQUEwQyxFQUVBM0MsR0FBQUksS0FBQSxRQUFBaUMsRUFBQVcsS0E1SUEsR0FBQXZDLEdBQUFSLEVBQUEsVUFDQVUsRUFBQVYsRUFBQSxpQkFDQWdELEVBQUFoRCxFQUFBLGFBQ0FlLEVBQUFmLEVBQUEsZUFFQSxNQUFBc0IsR0FBQSxFQUNBRyxFQUFBLENBRUEsSUFFQXJCLEdBQUEsSUFFQSxNQUFBZ0MsSUFDQSxRQUNBLFdBQ0EsV0FDQSxPQWtKQSxPQS9HQVksR0FBQXZDLEdBQUEsUUFBQUYsSUFnSEFZLFlBQUFBLEVBQ0EwQixVQUFBQSxFQUNBbEIsS0FBQUEsRUFDQWQsU0FBQUEsRUFDQUQsTUFBQUEsTUN6S0FxQyxRQUFBLFdBVUEsUUFBQUMsS0FDQUMsRUFBQUMsWUFHQSxRQUFBQyxLQUNBQyxFQUFBRixZQUdBLFFBQUFHLEtBQ0FDLEVBQUFKLFlBR0EsUUFBQUssS0FDQU4sRUFBQU8sUUFHQSxRQUFBQyxLQUNBTCxFQUFBSSxRQUdBLFFBQUFFLEtBQ0FKLEVBQUFFLFFBN0JBLEdBQUFHLEdBQUE3RCxFQUFBLFFBQ0E4RCxFQUFBOUQsRUFBQSxZQUNBK0QsRUFBQS9ELEVBQUEsVUFFQW1ELEVBQUFsQixTQUFBQyxlQUFBLGNBQ0FvQixFQUFBckIsU0FBQUMsZUFBQSxrQkFDQXNCLEVBQUF2QixTQUFBQyxlQUFBLGVBMEJBMkIsR0FBQXBELEdBQUEsUUFBQXlDLEdBQ0FZLEVBQUFyRCxHQUFBLFFBQUE0QyxHQUNBVSxFQUFBdEQsR0FBQSxRQUFBOEMsR0FFQUosRUFBQWEsY0FBQSxVQUFBQyxpQkFBQSxRQUFBUixHQUNBSCxFQUFBVSxjQUFBLFVBQUFDLGlCQUFBLFFBQUFOLEdBQ0FILEVBQUFRLGNBQUEsVUFBQUMsaUJBQUEsUUFBQUwsTUN4Q0F2RCxZQUFBLFdBSUEsUUFBQUUsS0FDQTJELEtBQUFDLE9BQUFDLFVBQUE3RCxXQUFBOEQsUUFBQSxTQUFBQyxHQUVBQyxFQUFBRCxFQUFBRSxJQUNBM0UsTUFBQWdELFVBQUE0QixLQUFBQyxNQUFBSixFQUFBekUsUUFDQThFLE1BSUEsUUFBQUMsS0FFQVYsS0FBQUMsT0FBQUMsVUFBQVEsbUJBQUFQLFFBQUEsU0FBQUMsR0FDQSxHQUFBLEtBQUFBLEVBQUFPLEtBQ0F0RSxRQUVBLENBQ0FnRSxFQUFBRCxFQUFBRSxJQUNBM0UsTUFBQWdELFVBQUE0QixLQUFBQyxNQUFBSixFQUFBekUsT0FDQSxJQUFBaUYsR0FBQUMsU0FBQVQsRUFBQVEsTUFDQWpGLE9BQUFnQixTQUFBaUUsSUFDQSxHQUFBQSxHQUFBSCxPQUtBLFFBQUFyRSxHQUFBdUIsRUFBQUMsR0FDQSxHQUFBa0QsR0FBQW5ELEVBQUFvRCxNQUFBLEtBQ0FDLEVBQUFwRCxFQUFBbUQsTUFBQSxJQUVBLEtBRUFmLEtBQUFDLE9BQUFDLFVBQUE5RCxhQUNBNkUsU0FBQVosRUFDQWEsV0FBQUosRUFBQSxHQUNBSyxjQUFBTCxFQUFBLEdBQ0FNLGdCQUFBSixFQUFBLEdBQ0FLLG1CQUFBTCxFQUFBLEtBQ0FiLFFBQUEsU0FBQUMsR0FDQXpFLE1BQUFlLFFBQ0E0RSxRQUFBQyxJQUFBbkIsR0FDQUEsRUFBQU8sT0FDQWhGLE1BQUE4QixLQUNBMkMsRUFBQTFDLGFBQ0EwQyxFQUFBekMsT0FDQXlDLEVBQUF4QyxZQUNBLE1BQUF3QyxFQUFBdkMsU0FDQTBDLEtBQUFDLE1BQ0FKLEVBQUF2QyxTQUFBMkQsUUFBQSxJQUFBLEtBQUFBLFFBQUEsSUFBQSxNQUNBLE1BRUE3RixNQUFBZ0IsU0FBQWtFLFNBQUFULEVBQUF4RCxjQUNBNkQsT0FLQSxNQUFBZ0IsS0FLQSxRQUFBaEIsS0FDQVQsS0FBQUMsT0FBQUMsVUFBQU8sU0FDQVEsU0FBQVosSUFDQUYsUUFBQSxTQUFBQyxHQUNBa0IsUUFBQUMsSUFBQW5CLEdBQ0F6RSxNQUFBOEIsS0FDQTJDLEVBQUExQyxhQUNBMEMsRUFBQXpDLE9BQ0F5QyxFQUFBeEMsWUFDQSxNQUFBd0MsRUFBQXZDLFNBQ0EwQyxLQUFBQyxNQUNBSixFQUFBdkMsU0FBQTJELFFBQUEsSUFBQSxLQUFBQSxRQUFBLElBQUEsTUFDQSxNQUVBN0YsTUFBQWdCLFNBQUFrRSxTQUFBVCxFQUFBeEQsZUE3RUEsR0FBQXlELEdBQUEsSUFnRkEsUUFDQWhFLFNBQUFBLEVBQ0FELFlBQUFBLEVBQ0FxRSxRQUFBQSxFQUNBQyxpQkFBQUEsTUN0RkFnQixZQUFBLFdBTUEsUUFBQUMsS0FDQTNCLEtBQUFDLE9BQUEyQixLQUNBLFNBQ0EsTUFFQTVCLEtBQUFDLE9BQUEyQixLQUNBLFlBQ0EsS0FDQUMsRUFDQUMsR0FJQSxRQUFBRCxLQUNBRSxFQUFBQyxXQUFBLEdBQ0FDLFdBQUFDLFFBQUFDLGNBQUEsS0FJQSxRQUFBSixHQUFBQyxHQUNBaEMsS0FBQW9DLEtBQUFDLFdBQ0FDLFVBQUEsMkVBQ0FDLE1BQUEsaURBQ0FQLFVBQUFBLEdBQ0FRLEdBR0EsUUFBQUMsS0FDQSxNQUFBQyxHQUdBLFFBQUFGLEdBQUFHLEdBQ0EzQyxLQUFBQyxPQUFBMkMsT0FBQUMsU0FBQUMsTUFBQTNDLFFBQUEsU0FBQTRDLEdBQ0FBLEVBQUFwQyxPQUNBdUIsUUFBQWMsWUFBQUQsRUFBQUUsUUFBQUYsRUFBQUcsTUFDQVIsR0FBQSxFQUVBdkcsWUFBQXVFLHNCQXhDQSxLQUFBb0IsR0FBQSw0Q0FDQSxJQUFBWSxJQUFBLENBNENBLFFBQ0FmLFlBQUFBLEVBQ0FjLFNBQUFBLEVBQ0FWLE9BQUFBLE1DbkRBRyxRQUFBLFdBS0EsUUFBQUMsS0FDQWdCLEVBQUE1RyxHQUFBLFFBQUE2RyxHQUNBRCxFQUFBbkcsWUFBQSxVQUVBLFFBQUFvRyxLQUNBMUIsWUFBQUssT0FBQUMsV0FBQSxHQUtBLFFBQUFnQixHQUFBSyxFQUFBSCxHQUNBSSxFQUFBQyxLQUFBTCxHQUNBSSxFQUFBdEcsWUFBQSxVQUNBbUcsRUFBQTFHLFNBQUEsVUFqQkEsR0FBQTBHLEdBQUFySCxFQUFBLFVBRUF3SCxFQUFBeEgsRUFBQSxRQWlCQSxRQUNBcUcsWUFBQUEsRUFDQWEsWUFBQUEiLCJmaWxlIjoic2NyaXB0cy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJ2YXIgYm9hcmQgPSAoZnVuY3Rpb24oKSB7XG5cbiAgIHZhciAkYm9hcmQgPSAkKFwiI2JvYXJkXCIpO1xuICAgdmFyICRib2FyZF9oZWFkZXIgPSAkKFwiI2JvYXJkX2hlYWRlclwiKTtcbiAgIHZhciAkbmV3X2dhbWUgPSAkKFwiI25ld19nYW1lXCIpO1xuICAgdmFyICRoZWFkZXJfdGV4dCA9ICQoXCIjaGVhZGVyX3RleHRcIik7XG5cbiAgIGNvbnN0IEhFSUdIVCA9IDk7XG4gICBjb25zdCBXSURUSCA9IDk7XG5cbiAgIHZhciBib2FyZDtcblxuICAgdmFyICRzZWxlY3RlZCA9IG51bGw7XG5cbiAgIGNvbnN0IHR5cGVOYW1lcyA9IFtcbiAgICAgICdlbXB0eScsXG4gICAgICAnYXR0YWNrZXInLFxuICAgICAgJ2RlZmVuZGVyJyxcbiAgICAgICdraW5nJ1xuICAgXTtcblxuICAgZnVuY3Rpb24gb25DbGljaygpIHtcbiAgICAgIHZhciAkY2VsbCA9ICQodGhpcyk7XG4gICAgICB2YXIgdHlwZSA9ICRjZWxsLmF0dHIoJ2NsYXNzJyk7XG5cbiAgICAgIGlmKHR5cGUgPT0gXCJhdHRhY2tlclwiKSB7XG4gICAgICAgICBpZigkc2VsZWN0ZWQpIHtcbiAgICAgICAgICAgICRzZWxlY3RlZC5hdHRyKCdjbGFzcycsJ2F0dGFja2VyJyk7XG4gICAgICAgICAgICAkc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkY2VsbC5hdHRyKCdjbGFzcycsJ2F0dGFja2VyLXNlbGVjdCcpO1xuICAgICAgICAgICAgJHNlbGVjdGVkID0gJGNlbGw7XG4gICAgICAgICB9XG4gICAgICB9XG4gICAgICBlbHNlIGlmKCRzZWxlY3RlZCl7XG4gICAgICAgICBpZih0eXBlID09IFwiZW1wdHlcIikge1xuICAgICAgICAgICAgdmFyIHJlc3VsdCA9IGdvb2dsZV9hcGlzLnBsYXllcl9tb3ZlKFxuICAgICAgICAgICAgICAgJHNlbGVjdGVkLmF0dHIoJ2lkJyksXG4gICAgICAgICAgICAgICAkY2VsbC5hdHRyKCdpZCcpXG4gICAgICAgICAgICApO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAkc2VsZWN0ZWQuYXR0cignY2xhc3MnLCdhdHRhY2tlcicpO1xuICAgICAgICAgICAgJHNlbGVjdGVkID0gbnVsbDtcbiAgICAgICAgIH1cbiAgICAgIH1cbiAgIH1cbiAgIGZ1bmN0aW9uIG5ld19nYW1lKCkge1xuICAgICAgJGJvYXJkLm9uKCdjbGljaycsJy5yb3cgPiBkaXYgPiBkaXYnLCBvbkNsaWNrKTtcbiAgICAgIGdvb2dsZV9hcGlzLm5ld19nYW1lKCk7XG4gICAgICAkYm9hcmRfaGVhZGVyLmFkZENsYXNzKCdoaWRkZW4nKTtcbiAgIH1cbiAgICRuZXdfZ2FtZS5vbignY2xpY2snLG5ld19nYW1lKTtcblxuICAgZnVuY3Rpb24gY2VsbENsaWNrKHRhcmdldCwgcGFyYW1zKSB7XG5cbiAgIH1cblxuICAgZnVuY3Rpb24gcmVzZXQoKSB7XG4gICAgICBpZigkc2VsZWN0ZWQpIHtcbiAgICAgICAgICRzZWxlY3RlZC5hdHRyKCdjbGFzcycsJ2F0dGFja2VyJyk7XG4gICAgICAgICAkc2VsZWN0ZWQgPSBudWxsO1xuICAgICAgfVxuICAgfVxuXG4gICBmdW5jdGlvbiBnYW1lX2VuZChnYW1lX3N0YXRlKSB7XG4gICAgICBpZihnYW1lX3N0YXRlID09IDIgfHwgZ2FtZV9zdGF0ZSA9PSAzKSB7XG4gICAgICAgICBpZihnYW1lX3N0YXRlID09IDIpe1xuICAgICAgICAgICAgJGhlYWRlcl90ZXh0LnRleHQoXCJQbGF5ZXIgd29uIVwiKTtcbiAgICAgICAgICAgICRib2FyZF9oZWFkZXIuYWRkQ2xhc3MoXCJhdHRhY2tlci1oZWFkZXJcIik7XG4gICAgICAgICB9XG4gICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAkYm9hcmRfaGVhZGVyLmFkZENsYXNzKFwiZGVmZW5kZXItaGVhZGVyXCIpO1xuICAgICAgICAgICAgICRoZWFkZXJfdGV4dC50ZXh0KFwiQUkgd29uIVwiKTtcbiAgICAgICAgICB9XG4gICAgICAgICAkYm9hcmQub2ZmKCk7XG4gICAgICAgICAkYm9hcmRfaGVhZGVyLnJlbW92ZUNsYXNzKCdoaWRkZW4nKTtcbiAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgfVxuXG4gICBmdW5jdGlvbiBlbXB0eV9ib2FyZCgpIHtcblxuICAgICAgJGJvYXJkID0gJChcIiNib2FyZFwiKTtcbiAgICAgIHZhciB0YWJsZV9idWlsZGVyID0gXCJcIjtcbiAgIFx0Zm9yKHZhciByb3c9MDsgcm93PCBIRUlHSFQ7IHJvdysrKXtcbiAgICAgICAgIHZhciByb3dfYnVpbGRlciA9IFwiPGRpdiBjbGFzcz0ncm93Jz5cIjtcbiAgIFx0XHRmb3IodmFyIGNvbD0wOyBjb2w8IFdJRFRIOyBjb2wrKykge1xuICAgICAgICAgICAgcm93X2J1aWxkZXIgKz0gXCI8ZGl2PjxkaXYgZGF0YS12YWw9JzAnIGNsYXNzPSdlbXB0eScgaWQ9J1wiICsgcm93ICsgXCIsXCIgKyBjb2wgKyBcIic+PC9kaXY+PC9kaXY+XCI7XG4gICBcdFx0fVxuICAgICAgICAgcm93X2J1aWxkZXIgKz0gXCI8L2Rpdj5cIjtcblxuICAgICAgICAgdGFibGVfYnVpbGRlciArPSByb3dfYnVpbGRlcjtcbiAgIFx0fVxuXG4gICAgICAkYm9hcmQuYXBwZW5kKHRhYmxlX2J1aWxkZXIpO1xuXG4gICAgICAkYm9hcmQub24oJ2NsaWNrJywnLnJvdyA+IGRpdiA+IGRpdicsIG9uQ2xpY2spO1xuXG4gICB9XG5cbiAgIGZ1bmN0aW9uIGZhZGVJbk5ld0NsYXNzKHNvdXJjZSwgZnJvbV9jbGFzcywgdG9fY2xhc3MpIHtcbiAgICAgIHNvdXJjZS5zd2l0Y2hDbGFzcyhmcm9tX2NsYXNzLCB0b19jbGFzcywgMTAwMCk7XG4gICB9XG5cbiAgIGZ1bmN0aW9uIG1vdmUob3JpZ2luX3ZhbHVlLCBvcmlnaW4sIGRlc3RpbmF0aW9uLCBjYXB0dXJlcykge1xuXG5cblxuICAgICAgdmFyIG9yID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQob3JpZ2luKTtcbiAgICAgIHZhciAkb3IgPSAkKG9yKTtcbiAgICAgICRvci5hdHRyKCdjbGFzcycsdHlwZU5hbWVzWzBdKTtcblxuICAgICAgdmFyIGRlID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGVzdGluYXRpb24pO1xuICAgICAgdmFyICRkZSA9ICQoZGUpO1xuICAgICAgJGRlLmF0dHIoJ2NsYXNzJyx0eXBlTmFtZXNbb3JpZ2luX3ZhbHVlXSk7XG5cbiAgICAgIGlmKGNhcHR1cmVzICYmIGNhcHR1cmVzWzBdKSB7XG5cbiAgICAgICAgIGZvcih2YXIgaT0wOyBpPCBjYXB0dXJlcy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgZiA9IGNhcHR1cmVzW2ldWzBdO1xuICAgICAgICAgICAgdCA9IGNhcHR1cmVzW2ldWzFdO1xuICAgICAgICAgICAgdmFyIGNhID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZiArIFwiLFwiICsgdCk7XG4gICAgICAgICAgICB2YXIgJGNhID0gJChjYSk7XG4gICAgICAgICAgICAkY2EuYXR0cignY2xhc3MnLHR5cGVOYW1lc1swXSk7XG4gICAgICAgICB9XG4gICAgICB9XG4gICB9XG5cbiAgIGZ1bmN0aW9uIG5ld19ib2FyZChib2FyZCkge1xuICAgICAgYm9hcmQgPSBib2FyZDtcbiAgIFx0Zm9yKHZhciByb3c9MDsgcm93IDwgYm9hcmQubGVuZ3RoOyByb3crKyl7XG4gICAgICAgICB2YXIgY29sdW1uV2lkdGggPSBib2FyZFtyb3ddLmxlbmd0aDtcbiAgIFx0XHRmb3IodmFyIGNvbD0wOyBjb2wgPCBjb2x1bW5XaWR0aDsgY29sKyspIHtcbiAgICAgICAgICAgIHZhciB2YWwgPSBib2FyZFtyb3ddW2NvbF07XG5cbiAgICAgICAgICAgICAgIHZhciB0ID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocm93ICsgXCIsXCIgKyBjb2wpO1xuXG4gICAgICAgICAgICAgICB2YXIgJGNlbGwgPSAkKHQpO1xuXG4gICAgICAgICAgICAgICAkY2VsbC5hdHRyKCdjbGFzcycsdHlwZU5hbWVzW3ZhbF0pO1xuXG4gICBcdFx0fVxuICAgXHR9XG5cbiAgIH1cblxuICAgZnVuY3Rpb24gbWFrZV9tb3ZlKGZyb21fciwgZnJvbV9jLCB0b19yLCB0b19jLCBjYXB0dXJlcywgdmFsdWUpIHtcblxuICAgICAgYm9hcmRbZnJvbV9yXVtmcm9tX2NdID0gMDtcbiAgICAgIGJvYXJkW3RvX3JdW3RvX2NdID0gdmFsdWU7XG4gICAgICAkKFwiI1wiICsgZnJvbV9yICsgXCIsXCIgKyBmcm9tX2MpLmF0dHIoJ2NsYXNzJywnZW1wdHknKTtcbiAgICAgICQoXCIjXCIgKyB0b19yICsgXCIsXCIgKyB0b19jKS5hdHRyKCdjbGFzcycsdHlwZU5hbWVzW3ZhbHVlXSk7XG4gICAgICBmb3IodmFyIGNhcHR1cmUgaW4gY2FwdHVyZXMpIHtcbiAgICAgICAgIHZhciByID0gY2FwdHVyZVswXTtcbiAgICAgICAgIHZhciBjID0gY2FwdHVyZVsxXTtcbiAgICAgICAgIGJvYXJkW3JdW2NdID0gMDtcbiAgICAgICAgICQoXCIjXCIgKyByICsgXCIsXCIgKyBjKS5hdHRyKCdjbGFzcycsJ2VtcHR5Jyk7XG4gICAgICB9XG5cbiAgIH1cblxuICAgcmV0dXJuIHtcbiAgICAgIGVtcHR5X2JvYXJkOiBlbXB0eV9ib2FyZCxcbiAgICAgIG5ld19ib2FyZDogbmV3X2JvYXJkLFxuICAgICAgbW92ZTogbW92ZSxcbiAgICAgIGdhbWVfZW5kOiBnYW1lX2VuZCxcbiAgICAgIHJlc2V0OiByZXNldFxuICAgfTtcbn0pKCk7XG4iLCJ2YXIgZGlhbG9ncyA9IChmdW5jdGlvbigpe1xuXG4gICB2YXIgJGhvdyA9ICQoXCIjaG93XCIpO1xuICAgdmFyICRoaXN0b3J5ID0gJChcIiNoaXN0b3J5XCIpO1xuICAgdmFyICRhYm91dCA9ICQoXCIjYWJvdXRcIik7XG5cbiAgIHZhciBob3dfZGlhbG9nID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hvdy1kaWFsb2cnKTtcbiAgIHZhciBoaXN0b3J5X2RpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdoaXN0b3J5LWRpYWxvZycpO1xuICAgdmFyIGFib3V0X2RpYWxvZyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdhYm91dC1kaWFsb2cnKTtcblxuICAgZnVuY3Rpb24gb3Blbkhvdygpe1xuICAgICAgaG93X2RpYWxvZy5zaG93TW9kYWwoKTtcbiAgIH1cblxuICAgZnVuY3Rpb24gb3Blbkhpc3RvcnkoKSB7XG4gICAgICBoaXN0b3J5X2RpYWxvZy5zaG93TW9kYWwoKTtcbiAgIH1cblxuICAgZnVuY3Rpb24gb3BlbkFib3V0KCkge1xuICAgICAgYWJvdXRfZGlhbG9nLnNob3dNb2RhbCgpO1xuICAgfVxuXG4gICBmdW5jdGlvbiBjbG9zZUhvdygpIHtcbiAgICAgIGhvd19kaWFsb2cuY2xvc2UoKTtcbiAgIH1cblxuICAgZnVuY3Rpb24gY2xvc2VIaXN0b3J5KCkge1xuICAgICAgaGlzdG9yeV9kaWFsb2cuY2xvc2UoKTtcbiAgIH1cblxuICAgZnVuY3Rpb24gY2xvc2VBYm91dCgpIHtcbiAgICAgIGFib3V0X2RpYWxvZy5jbG9zZSgpO1xuICAgfVxuXG4gICAkaG93Lm9uKCdjbGljaycsIG9wZW5Ib3cpO1xuICAgJGhpc3Rvcnkub24oJ2NsaWNrJywgb3Blbkhpc3RvcnkpO1xuICAgJGFib3V0Lm9uKCdjbGljaycsIG9wZW5BYm91dCk7XG5cbiAgIGhvd19kaWFsb2cucXVlcnlTZWxlY3RvcignLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZUhvdyk7XG4gICBoaXN0b3J5X2RpYWxvZy5xdWVyeVNlbGVjdG9yKCcuY2xvc2UnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIGNsb3NlSGlzdG9yeSk7XG4gICBhYm91dF9kaWFsb2cucXVlcnlTZWxlY3RvcignLmNsb3NlJykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBjbG9zZUFib3V0KTtcblxufSkoKTtcbiIsInZhciBnb29nbGVfYXBpcyA9IChmdW5jdGlvbigpIHtcblxuICAgdmFyIEtFWSA9IG51bGw7XG5cbiAgIGZ1bmN0aW9uIG5ld19nYW1lKCkge1xuICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLm5ld19nYW1lKCkuZXhlY3V0ZShmdW5jdGlvbihyZXNwb25zZSl7XG5cbiAgICAgICAgIEtFWSA9IHJlc3BvbnNlLmtleTtcbiAgICAgICAgIGJvYXJkLm5ld19ib2FyZChKU09OLnBhcnNlKHJlc3BvbnNlLmJvYXJkKSk7XG4gICAgICAgICBhaV9tb3ZlKCk7XG4gICAgICB9KTtcbiAgIH1cblxuICAgZnVuY3Rpb24gbGFzdF9wbGF5ZXJfZ2FtZSgpIHtcblxuICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLmxhc3RfcGxheWVyX2dhbWUoKS5leGVjdXRlKGZ1bmN0aW9uKHJlc3BvbnNlKXtcbiAgICAgICAgIGlmKHJlc3BvbnNlLmNvZGUgPT0gNDA0KSB7XG4gICAgICAgICAgICBuZXdfZ2FtZSgpO1xuICAgICAgICAgfVxuICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBLRVkgPSByZXNwb25zZS5rZXk7XG4gICAgICAgICAgICBib2FyZC5uZXdfYm9hcmQoSlNPTi5wYXJzZShyZXNwb25zZS5ib2FyZCkpO1xuICAgICAgICAgICAgdmFyIHN0YXRlID0gcGFyc2VJbnQocmVzcG9uc2Uuc3RhdGUpO1xuICAgICAgICAgICAgaWYoIWJvYXJkLmdhbWVfZW5kKHN0YXRlKSlcbiAgICAgICAgICAgICAgIGlmKHN0YXRlID09IDEpIGFpX21vdmUoKTtcbiAgICAgICAgIH1cbiAgICAgIH0pO1xuICAgfVxuXG4gICBmdW5jdGlvbiBwbGF5ZXJfbW92ZShvcmlnaW4sIGRlc3RpbmF0aW9uKSB7XG4gICAgICB2YXIgb3JpZ2lucyA9IG9yaWdpbi5zcGxpdCgnLCcpO1xuICAgICAgdmFyIGRlc3RpbmF0aW9ucyA9IGRlc3RpbmF0aW9uLnNwbGl0KCcsJyk7XG5cbiAgICAgIHRyeVxuICAgICAge1xuICAgICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLnBsYXllcl9tb3ZlKHtcbiAgICAgICAgICAgIFwiZ2FtZV9rZXlcIjogS0VZLFxuICAgICAgICAgICAgXCJvcmlnaW5fcm93XCI6IG9yaWdpbnNbMF0sXG4gICAgICAgICAgICBcIm9yaWdpbl9jb2x1bW5cIjogb3JpZ2luc1sxXSxcbiAgICAgICAgICAgIFwiZGVzdGluYXRpb25fcm93XCI6IGRlc3RpbmF0aW9uc1swXSxcbiAgICAgICAgICAgIFwiZGVzdGluYXRpb25fY29sdW1uXCI6IGRlc3RpbmF0aW9uc1sxXVxuICAgICAgICAgfSkuZXhlY3V0ZShmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICBib2FyZC5yZXNldCgpXG4gICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICBpZighcmVzcG9uc2UuY29kZSkgIHtcbiAgICAgICAgICAgICAgIGJvYXJkLm1vdmUoXG4gICAgICAgICAgICAgICAgICByZXNwb25zZS5vcmlnaW5fdmFsdWUsXG4gICAgICAgICAgICAgICAgICByZXNwb25zZS5vcmlnaW4sXG4gICAgICAgICAgICAgICAgICByZXNwb25zZS5kZXN0aW5hdGlvbixcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNhcHR1cmVzICE9IFwiW11cIiA/XG4gICAgICAgICAgICAgICAgICBKU09OLnBhcnNlKFxuICAgICAgICAgICAgICAgICAgICAgcmVzcG9uc2UuY2FwdHVyZXMucmVwbGFjZSgnKCcsJ1snKS5yZXBsYWNlKCcpJywnXScpXG4gICAgICAgICAgICAgICAgICApOiBudWxsXG4gICAgICAgICAgICAgICApO1xuICAgICAgICAgICAgICAgaWYoIWJvYXJkLmdhbWVfZW5kKHBhcnNlSW50KHJlc3BvbnNlLmdhbWVfc3RhdGUpKSkge1xuICAgICAgICAgICAgICAgICAgYWlfbW92ZSgpO1xuICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgfSk7XG4gICAgICB9XG4gICAgICBjYXRjaChlcnIpIHtcblxuICAgICAgfVxuICAgfVxuXG4gICAgICBmdW5jdGlvbiBhaV9tb3ZlKCkge1xuICAgICAgICAgZ2FwaS5jbGllbnQuaG5lZmF0YWZsLmFpX21vdmUoe1xuICAgICAgICAgICAgXCJnYW1lX2tleVwiOktFWVxuICAgICAgICAgfSkuZXhlY3V0ZShmdW5jdGlvbihyZXNwb25zZSl7XG4gICAgICAgICAgICBjb25zb2xlLmxvZyhyZXNwb25zZSk7XG4gICAgICAgICAgICBib2FyZC5tb3ZlKFxuICAgICAgICAgICAgICAgcmVzcG9uc2Uub3JpZ2luX3ZhbHVlLFxuICAgICAgICAgICAgICAgcmVzcG9uc2Uub3JpZ2luLFxuICAgICAgICAgICAgICAgcmVzcG9uc2UuZGVzdGluYXRpb24sXG4gICAgICAgICAgICAgICByZXNwb25zZS5jYXB0dXJlcyAhPSBcIltdXCIgP1xuICAgICAgICAgICAgICAgSlNPTi5wYXJzZShcbiAgICAgICAgICAgICAgICAgIHJlc3BvbnNlLmNhcHR1cmVzLnJlcGxhY2UoJygnLCdbJykucmVwbGFjZSgnKScsJ10nKVxuICAgICAgICAgICAgICAgKTogbnVsbFxuICAgICAgICAgICAgKTtcbiAgICAgICAgICAgIGJvYXJkLmdhbWVfZW5kKHBhcnNlSW50KHJlc3BvbnNlLmdhbWVfc3RhdGUpKTtcbiAgICAgICAgIH0pO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgIG5ld19nYW1lOiBuZXdfZ2FtZSxcbiAgICAgICAgIHBsYXllcl9tb3ZlOiBwbGF5ZXJfbW92ZSxcbiAgICAgICAgIGFpX21vdmU6IGFpX21vdmUsXG4gICAgICAgICBsYXN0X3BsYXllcl9nYW1lOiBsYXN0X3BsYXllcl9nYW1lXG4gICAgICB9O1xufSkoKTtcbiIsInZhciBnb29nbGVfYXV0aCA9IChmdW5jdGlvbigpe1xuXG4gICAvL2NvbnN0IHVybCA9IFwiaHR0cDovL2xvY2FsaG9zdDo4MDgwL19haC9hcGlcIjtcbiAgIGNvbnN0IHVybCA9IFwiaHR0cHM6Ly9obmVmYXRhZmwtZ2FtZS5hcHBzcG90LmNvbS9fYWgvYXBpXCI7XG4gICB2YXIgc2lnbmVkaW4gPSBmYWxzZTtcblxuICAgZnVuY3Rpb24gbG9hZE1vZHVsZXMoKXtcbiAgICAgIGdhcGkuY2xpZW50LmxvYWQoXG4gICAgICAgICAnb2F1dGgyJyxcbiAgICAgICAgICd2MidcbiAgICAgICk7XG4gICAgICBnYXBpLmNsaWVudC5sb2FkKFxuICAgICAgICAgJ2huZWZhdGFmbCcsXG4gICAgICAgICAndjEnLFxuICAgICAgICAgYWZ0ZXJMb2FkZWQsXG4gICAgICAgICB1cmxcbiAgICAgICk7XG4gICB9XG5cbiAgIGZ1bmN0aW9uIGFmdGVyTG9hZGVkKCkge1xuICAgICAgc2lnbmluKGltbWVkaWF0ZSA9IHRydWUpO1xuICAgICAgc2V0VGltZW91dChwcm9maWxlLmVuYWJsZUxvZ2luKCksIDIwMDApO1xuXG4gICB9XG5cbiAgIGZ1bmN0aW9uIHNpZ25pbihpbW1lZGlhdGUpIHtcbiAgICAgIGdhcGkuYXV0aC5hdXRob3JpemUoe1xuICAgICAgICAgY2xpZW50X2lkOiAnMzE0MjcyMTYwMjUwLXVjcnFnNDRjMW9qOWtubHJmYXRxdnFmMWIzcG05ODE5LmFwcHMuZ29vZ2xldXNlcmNvbnRlbnQuY29tJyxcbiAgICAgICAgIHNjb3BlOiAnaHR0cHM6Ly93d3cuZ29vZ2xlYXBpcy5jb20vYXV0aC91c2VyaW5mby5lbWFpbCcsXG4gICAgICAgICBpbW1lZGlhdGU6IGltbWVkaWF0ZVxuICAgICAgfSwgdXNlckF1dGhlZCk7XG4gICB9XG5cbiAgIGZ1bmN0aW9uIGlzQXV0aGVkKCkge1xuICAgICAgcmV0dXJuIHNpZ25lZGluO1xuICAgfVxuXG4gICBmdW5jdGlvbiB1c2VyQXV0aGVkKG1vZGUpIHtcbiAgICAgIHZhciByZXF1ZXN0ID0gZ2FwaS5jbGllbnQub2F1dGgyLnVzZXJpbmZvLmdldCgpLmV4ZWN1dGUoZnVuY3Rpb24ocmVzcCkge1xuICAgICAgICAgaWYgKCFyZXNwLmNvZGUpIHtcbiAgICAgICAgICAgIHByb2ZpbGUuc2V0TG9nZ2VkSW4ocmVzcC5waWN0dXJlLCByZXNwLm5hbWUpO1xuICAgICAgICAgICAgc2lnbmVkaW4gPSB0cnVlO1xuICAgICAgICAgICAgLy9nb29nbGVfYXBpcy5uZXdfZ2FtZShnb29nbGVfYXBpcy5haV9tb3ZlKTtcbiAgICAgICAgICAgIGdvb2dsZV9hcGlzLmxhc3RfcGxheWVyX2dhbWUoKTtcbiAgICAgICAgIC8vICAgZ29vZ2xlX2FwaXMuYWlfbW92ZSgpO1xuICAgICAgICAgIH1cbiAgICAgfSk7XG4gICB9XG4gICByZXR1cm4ge1xuICAgICAgbG9hZE1vZHVsZXM6IGxvYWRNb2R1bGVzLFxuICAgICAgaXNBdXRoZWQ6IGlzQXV0aGVkLFxuICAgICAgc2lnbmluOiBzaWduaW5cbiAgIH07XG5cbn0pKCk7XG4iLCJ2YXIgcHJvZmlsZSA9IChmdW5jdGlvbigpIHtcbiAgIHZhciAkbG9naW4gPSAkKFwiI2xvZ2luXCIpO1xuICAgLy92YXIgJHBpY3R1cmUgPSAkKFwiI3BpY3R1cmVcIik7XG4gICB2YXIgJG5hbWUgPSAkKFwiI25hbWVcIik7XG5cbiAgIGZ1bmN0aW9uIGVuYWJsZUxvZ2luKCkge1xuICAgICAgJGxvZ2luLm9uKCdjbGljaycsIF9sb2dpbkNsaWNrKTtcbiAgICAgICRsb2dpbi5yZW1vdmVDbGFzcyhcImhpZGRlblwiKTtcbiAgIH1cbiAgIGZ1bmN0aW9uIF9sb2dpbkNsaWNrKCkge1xuICAgICAgZ29vZ2xlX2F1dGguc2lnbmluKGltbWVkaWF0ZSA9IGZhbHNlKTtcbiAgIH1cbiAgIGZ1bmN0aW9uIF9sb2dvdXRDbGljaygpIHtcbiAgICAgIC8vc2luZ2luKGltbWVkaWF0ZSA9IGZhbHNlKTtcbiAgIH1cbiAgIGZ1bmN0aW9uIHNldExvZ2dlZEluKHNyYywgbmFtZSkge1xuICAgICAgJG5hbWUuaHRtbChuYW1lKTtcbiAgICAgICRuYW1lLnJlbW92ZUNsYXNzKFwiaGlkZGVuXCIpO1xuICAgICAgJGxvZ2luLmFkZENsYXNzKFwiaGlkZGVuXCIpO1xuICAgfVxuICAgcmV0dXJuIHtcbiAgICAgIGVuYWJsZUxvZ2luOiBlbmFibGVMb2dpbixcbiAgICAgIHNldExvZ2dlZEluOiBzZXRMb2dnZWRJblxuICAgfTtcbn0pKCk7XG4iXSwic291cmNlUm9vdCI6Ii9zb3VyY2UvIn0=
