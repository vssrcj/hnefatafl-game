<html>
	<head>
			<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, initial-scale=1.0">
			<title>Hnefatafl</title>
			<link rel="stylesheet" href="http://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.min.css">
			<link rel="stylesheet" href="content/site.css">


	</head>
	<body>
		<div class="row">
			<div class="small-12 medium-8 large-6 columns medium-centered large-centered">
				<svg version="1.1" viewBox="0 0 630 630" id="svg"></svg>
			</div>
		</div>
		<script class="white" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
		<script class="white" src="http://dhbhdrzi4tiry.cloudfront.net/cdn/sites/foundation.js"></script>


		<script type="text/javascript">

		var KEY;
		var BOARD;

		function init() {

			gapi.client.load(
				'hnefatafl',
				'v1',
				function() {
					api_new_game();
				},
				'http://localhost:8080/_ah/api'
			);
		}

		function api_new_game() {
			gapi.client.hnefatafl.new_game({"email":"v"}).execute(function(response){
				KEY = response.key;
				board  = parse_board(response.board);
				ai_move(true);
				//new_board();
			});
		}

		function ai_move(first) {
			alert('ai_move');
			gapi.client.hnefatafl.ai_move({"game_key":KEY}).execute(function(response){
				parse_board(response.board);
				if(first) new_board();
				else change_board();
			});
		}


		function api_player_move(cell_from, cell_to) {
			alert('player_move');
			gapi.client.hnefatafl.player_move({
				"game_key": KEY,
				"cell_from": cell_from,
				"cell_to": cell_to
			}).execute(function(response){
				parse_board(response.board);
				change_board();
				ai_move(false);
			});

		}

		function parse_board(board) {
			var b = board.replace(/(],)+/g, '|'); //  split('],');
			b = b.replace(/[\[\]]+/g, ''); //replace(/(],)+/g, '');
			b = b.split('|');
			s = [];
			for(var i=0; i < b.length; i++) {
				var row = b[i].split(',');
				var push_row = [];
				for(var y=0; y < row.length; y++) {
					push_row.push(parseInt(row[y].trim()));
				}
				s.push(push_row);
			}

			BOARD = s;

			//console.log(b);
			/*var b = board.replace(/[\[\]]+/g, '').split(',');
			var t = '';
			for(var i=0; i < b.length; i++) {
				t += b[i] + ',';
			}*/

		}

		</script>
		<script src="https://apis.google.com/js/client.js?onload=init"></script>
		<script src="content/site.js"></script>
	</body>
</head>
